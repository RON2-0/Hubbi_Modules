(function(_,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("react/jsx-runtime"),require("react")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","react"],r):(_=typeof globalThis<"u"?globalThis:_||self,r((_.com=_.com||{},_.com.hubbi=_.com.hubbi||{},_.com.hubbi.inventory={}),_.HubbiJSX,_.React))})(this,function(_,r,v){"use strict";function Gt(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,o.get?o:{enumerable:!0,get:()=>e[t]})}}return n.default=e,Object.freeze(n)}const Ce=Gt(v),y=window.hubbi;var X={};/**
   * table-core
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function Ne(){return{accessor:(e,n)=>typeof e=="function"?{...n,accessorFn:e}:{...n,accessorKey:e},display:e=>e,group:e=>e}}function R(e,n){return typeof e=="function"?e(n):e}function z(e,n){return t=>{n.setState(o=>({...o,[e]:R(t,o[e])}))}}function ge(e){return e instanceof Function}function jt(e){return Array.isArray(e)&&e.every(n=>typeof n=="number")}function Bt(e,n){const t=[],o=i=>{i.forEach(s=>{t.push(s);const a=n(s);a!=null&&a.length&&o(a)})};return o(e),t}function N(e,n,t){let o=[],i;return s=>{let a;t.key&&t.debug&&(a=Date.now());const d=e(s);if(!(d.length!==o.length||d.some((h,f)=>o[f]!==h)))return i;o=d;let g;if(t.key&&t.debug&&(g=Date.now()),i=n(...d),t==null||t.onChange==null||t.onChange(i),t.key&&t.debug&&t!=null&&t.debug()){const h=Math.round((Date.now()-a)*100)/100,f=Math.round((Date.now()-g)*100)/100,c=f/16,l=(p,m)=>{for(p=String(p);p.length<m;)p=" "+p;return p};console.info(`%câ± ${l(f,5)} /${l(h,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*c,120))}deg 100% 31%);`,t==null?void 0:t.key)}return i}}function E(e,n,t,o){return{debug:()=>{var i;return(i=e==null?void 0:e.debugAll)!=null?i:e[n]},key:X.NODE_ENV==="development"&&t,onChange:o}}function Wt(e,n,t,o){const i=()=>{var a;return(a=s.getValue())!=null?a:e.options.renderFallbackValue},s={id:`${n.id}_${t.id}`,row:n,column:t,getValue:()=>n.getValue(o),renderValue:i,getContext:N(()=>[e,t,n,s],(a,d,u,g)=>({table:a,column:d,row:u,cell:g,getValue:g.getValue,renderValue:g.renderValue}),E(e.options,"debugCells","cell.getContext"))};return e._features.forEach(a=>{a.createCell==null||a.createCell(s,t,n,e)},{}),s}function Kt(e,n,t,o){var i,s;const d={...e._getDefaultColumnDef(),...n},u=d.accessorKey;let g=(i=(s=d.id)!=null?s:u?typeof String.prototype.replaceAll=="function"?u.replaceAll(".","_"):u.replace(/\./g,"_"):void 0)!=null?i:typeof d.header=="string"?d.header:void 0,h;if(d.accessorFn?h=d.accessorFn:u&&(u.includes(".")?h=c=>{let l=c;for(const m of u.split(".")){var p;l=(p=l)==null?void 0:p[m],X.NODE_ENV!=="production"&&l===void 0&&console.warn(`"${m}" in deeply nested key "${u}" returned undefined.`)}return l}:h=c=>c[d.accessorKey]),!g)throw X.NODE_ENV!=="production"?new Error(d.accessorFn?"Columns require an id when using an accessorFn":"Columns require an id when using a non-string header"):new Error;let f={id:`${String(g)}`,accessorFn:h,parent:o,depth:t,columnDef:d,columns:[],getFlatColumns:N(()=>[!0],()=>{var c;return[f,...(c=f.columns)==null?void 0:c.flatMap(l=>l.getFlatColumns())]},E(e.options,"debugColumns","column.getFlatColumns")),getLeafColumns:N(()=>[e._getOrderColumnsFn()],c=>{var l;if((l=f.columns)!=null&&l.length){let p=f.columns.flatMap(m=>m.getLeafColumns());return c(p)}return[f]},E(e.options,"debugColumns","column.getLeafColumns"))};for(const c of e._features)c.createColumn==null||c.createColumn(f,e);return f}const q="debugHeaders";function et(e,n,t){var o;let s={id:(o=t.id)!=null?o:n.id,column:n,index:t.index,isPlaceholder:!!t.isPlaceholder,placeholderId:t.placeholderId,depth:t.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const a=[],d=u=>{u.subHeaders&&u.subHeaders.length&&u.subHeaders.map(d),a.push(u)};return d(s),a},getContext:()=>({table:e,header:s,column:n})};return e._features.forEach(a=>{a.createHeader==null||a.createHeader(s,e)}),s}const Jt={createTable:e=>{e.getHeaderGroups=N(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,o,i)=>{var s,a;const d=(s=o==null?void 0:o.map(f=>t.find(c=>c.id===f)).filter(Boolean))!=null?s:[],u=(a=i==null?void 0:i.map(f=>t.find(c=>c.id===f)).filter(Boolean))!=null?a:[],g=t.filter(f=>!(o!=null&&o.includes(f.id))&&!(i!=null&&i.includes(f.id)));return pe(n,[...d,...g,...u],e)},E(e.options,q,"getHeaderGroups")),e.getCenterHeaderGroups=N(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,o,i)=>(t=t.filter(s=>!(o!=null&&o.includes(s.id))&&!(i!=null&&i.includes(s.id))),pe(n,t,e,"center")),E(e.options,q,"getCenterHeaderGroups")),e.getLeftHeaderGroups=N(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(n,t,o)=>{var i;const s=(i=o==null?void 0:o.map(a=>t.find(d=>d.id===a)).filter(Boolean))!=null?i:[];return pe(n,s,e,"left")},E(e.options,q,"getLeftHeaderGroups")),e.getRightHeaderGroups=N(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(n,t,o)=>{var i;const s=(i=o==null?void 0:o.map(a=>t.find(d=>d.id===a)).filter(Boolean))!=null?i:[];return pe(n,s,e,"right")},E(e.options,q,"getRightHeaderGroups")),e.getFooterGroups=N(()=>[e.getHeaderGroups()],n=>[...n].reverse(),E(e.options,q,"getFooterGroups")),e.getLeftFooterGroups=N(()=>[e.getLeftHeaderGroups()],n=>[...n].reverse(),E(e.options,q,"getLeftFooterGroups")),e.getCenterFooterGroups=N(()=>[e.getCenterHeaderGroups()],n=>[...n].reverse(),E(e.options,q,"getCenterFooterGroups")),e.getRightFooterGroups=N(()=>[e.getRightHeaderGroups()],n=>[...n].reverse(),E(e.options,q,"getRightFooterGroups")),e.getFlatHeaders=N(()=>[e.getHeaderGroups()],n=>n.map(t=>t.headers).flat(),E(e.options,q,"getFlatHeaders")),e.getLeftFlatHeaders=N(()=>[e.getLeftHeaderGroups()],n=>n.map(t=>t.headers).flat(),E(e.options,q,"getLeftFlatHeaders")),e.getCenterFlatHeaders=N(()=>[e.getCenterHeaderGroups()],n=>n.map(t=>t.headers).flat(),E(e.options,q,"getCenterFlatHeaders")),e.getRightFlatHeaders=N(()=>[e.getRightHeaderGroups()],n=>n.map(t=>t.headers).flat(),E(e.options,q,"getRightFlatHeaders")),e.getCenterLeafHeaders=N(()=>[e.getCenterFlatHeaders()],n=>n.filter(t=>{var o;return!((o=t.subHeaders)!=null&&o.length)}),E(e.options,q,"getCenterLeafHeaders")),e.getLeftLeafHeaders=N(()=>[e.getLeftFlatHeaders()],n=>n.filter(t=>{var o;return!((o=t.subHeaders)!=null&&o.length)}),E(e.options,q,"getLeftLeafHeaders")),e.getRightLeafHeaders=N(()=>[e.getRightFlatHeaders()],n=>n.filter(t=>{var o;return!((o=t.subHeaders)!=null&&o.length)}),E(e.options,q,"getRightLeafHeaders")),e.getLeafHeaders=N(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(n,t,o)=>{var i,s,a,d,u,g;return[...(i=(s=n[0])==null?void 0:s.headers)!=null?i:[],...(a=(d=t[0])==null?void 0:d.headers)!=null?a:[],...(u=(g=o[0])==null?void 0:g.headers)!=null?u:[]].map(h=>h.getLeafHeaders()).flat()},E(e.options,q,"getLeafHeaders"))}};function pe(e,n,t,o){var i,s;let a=0;const d=function(c,l){l===void 0&&(l=1),a=Math.max(a,l),c.filter(p=>p.getIsVisible()).forEach(p=>{var m;(m=p.columns)!=null&&m.length&&d(p.columns,l+1)},0)};d(e);let u=[];const g=(c,l)=>{const p={depth:l,id:[o,`${l}`].filter(Boolean).join("_"),headers:[]},m=[];c.forEach(b=>{const x=[...m].reverse()[0],w=b.column.depth===p.depth;let S,F=!1;if(w&&b.column.parent?S=b.column.parent:(S=b.column,F=!0),x&&(x==null?void 0:x.column)===S)x.subHeaders.push(b);else{const C=et(t,S,{id:[o,l,S.id,b==null?void 0:b.id].filter(Boolean).join("_"),isPlaceholder:F,placeholderId:F?`${m.filter(T=>T.column===S).length}`:void 0,depth:l,index:m.length});C.subHeaders.push(b),m.push(C)}p.headers.push(b),b.headerGroup=p}),u.push(p),l>0&&g(m,l-1)},h=n.map((c,l)=>et(t,c,{depth:a,index:l}));g(h,a-1),u.reverse();const f=c=>c.filter(p=>p.column.getIsVisible()).map(p=>{let m=0,b=0,x=[0];p.subHeaders&&p.subHeaders.length?(x=[],f(p.subHeaders).forEach(S=>{let{colSpan:F,rowSpan:C}=S;m+=F,x.push(C)})):m=1;const w=Math.min(...x);return b=b+w,p.colSpan=m,p.rowSpan=b,{colSpan:m,rowSpan:b}});return f((i=(s=u[0])==null?void 0:s.headers)!=null?i:[]),u}const Ee=(e,n,t,o,i,s,a)=>{let d={id:n,index:o,original:t,depth:i,parentId:a,_valuesCache:{},_uniqueValuesCache:{},getValue:u=>{if(d._valuesCache.hasOwnProperty(u))return d._valuesCache[u];const g=e.getColumn(u);if(g!=null&&g.accessorFn)return d._valuesCache[u]=g.accessorFn(d.original,o),d._valuesCache[u]},getUniqueValues:u=>{if(d._uniqueValuesCache.hasOwnProperty(u))return d._uniqueValuesCache[u];const g=e.getColumn(u);if(g!=null&&g.accessorFn)return g.columnDef.getUniqueValues?(d._uniqueValuesCache[u]=g.columnDef.getUniqueValues(d.original,o),d._uniqueValuesCache[u]):(d._uniqueValuesCache[u]=[d.getValue(u)],d._uniqueValuesCache[u])},renderValue:u=>{var g;return(g=d.getValue(u))!=null?g:e.options.renderFallbackValue},subRows:[],getLeafRows:()=>Bt(d.subRows,u=>u.subRows),getParentRow:()=>d.parentId?e.getRow(d.parentId,!0):void 0,getParentRows:()=>{let u=[],g=d;for(;;){const h=g.getParentRow();if(!h)break;u.push(h),g=h}return u.reverse()},getAllCells:N(()=>[e.getAllLeafColumns()],u=>u.map(g=>Wt(e,d,g,g.id)),E(e.options,"debugRows","getAllCells")),_getAllCellsByColumnId:N(()=>[d.getAllCells()],u=>u.reduce((g,h)=>(g[h.column.id]=h,g),{}),E(e.options,"debugRows","getAllCellsByColumnId"))};for(let u=0;u<e._features.length;u++){const g=e._features[u];g==null||g.createRow==null||g.createRow(d,e)}return d},Rt={createColumn:(e,n)=>{e._getFacetedRowModel=n.options.getFacetedRowModel&&n.options.getFacetedRowModel(n,e.id),e.getFacetedRowModel=()=>e._getFacetedRowModel?e._getFacetedRowModel():n.getPreFilteredRowModel(),e._getFacetedUniqueValues=n.options.getFacetedUniqueValues&&n.options.getFacetedUniqueValues(n,e.id),e.getFacetedUniqueValues=()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,e._getFacetedMinMaxValues=n.options.getFacetedMinMaxValues&&n.options.getFacetedMinMaxValues(n,e.id),e.getFacetedMinMaxValues=()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}},tt=(e,n,t)=>{var o,i;const s=t==null||(o=t.toString())==null?void 0:o.toLowerCase();return!!(!((i=e.getValue(n))==null||(i=i.toString())==null||(i=i.toLowerCase())==null)&&i.includes(s))};tt.autoRemove=e=>U(e);const nt=(e,n,t)=>{var o;return!!(!((o=e.getValue(n))==null||(o=o.toString())==null)&&o.includes(t))};nt.autoRemove=e=>U(e);const ot=(e,n,t)=>{var o;return((o=e.getValue(n))==null||(o=o.toString())==null?void 0:o.toLowerCase())===(t==null?void 0:t.toLowerCase())};ot.autoRemove=e=>U(e);const rt=(e,n,t)=>{var o;return(o=e.getValue(n))==null?void 0:o.includes(t)};rt.autoRemove=e=>U(e);const it=(e,n,t)=>!t.some(o=>{var i;return!((i=e.getValue(n))!=null&&i.includes(o))});it.autoRemove=e=>U(e)||!(e!=null&&e.length);const st=(e,n,t)=>t.some(o=>{var i;return(i=e.getValue(n))==null?void 0:i.includes(o)});st.autoRemove=e=>U(e)||!(e!=null&&e.length);const at=(e,n,t)=>e.getValue(n)===t;at.autoRemove=e=>U(e);const lt=(e,n,t)=>e.getValue(n)==t;lt.autoRemove=e=>U(e);const Ie=(e,n,t)=>{let[o,i]=t;const s=e.getValue(n);return s>=o&&s<=i};Ie.resolveFilterValue=e=>{let[n,t]=e,o=typeof n!="number"?parseFloat(n):n,i=typeof t!="number"?parseFloat(t):t,s=n===null||Number.isNaN(o)?-1/0:o,a=t===null||Number.isNaN(i)?1/0:i;if(s>a){const d=s;s=a,a=d}return[s,a]},Ie.autoRemove=e=>U(e)||U(e[0])&&U(e[1]);const K={includesString:tt,includesStringSensitive:nt,equalsString:ot,arrIncludes:rt,arrIncludesAll:it,arrIncludesSome:st,equals:at,weakEquals:lt,inNumberRange:Ie};function U(e){return e==null||e===""}const Yt={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],...e}),getDefaultOptions:e=>({onColumnFiltersChange:z("columnFilters",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(e,n)=>{e.getAutoFilterFn=()=>{const t=n.getCoreRowModel().flatRows[0],o=t==null?void 0:t.getValue(e.id);return typeof o=="string"?K.includesString:typeof o=="number"?K.inNumberRange:typeof o=="boolean"||o!==null&&typeof o=="object"?K.equals:Array.isArray(o)?K.arrIncludes:K.weakEquals},e.getFilterFn=()=>{var t,o;return ge(e.columnDef.filterFn)?e.columnDef.filterFn:e.columnDef.filterFn==="auto"?e.getAutoFilterFn():(t=(o=n.options.filterFns)==null?void 0:o[e.columnDef.filterFn])!=null?t:K[e.columnDef.filterFn]},e.getCanFilter=()=>{var t,o,i;return((t=e.columnDef.enableColumnFilter)!=null?t:!0)&&((o=n.options.enableColumnFilters)!=null?o:!0)&&((i=n.options.enableFilters)!=null?i:!0)&&!!e.accessorFn},e.getIsFiltered=()=>e.getFilterIndex()>-1,e.getFilterValue=()=>{var t;return(t=n.getState().columnFilters)==null||(t=t.find(o=>o.id===e.id))==null?void 0:t.value},e.getFilterIndex=()=>{var t,o;return(t=(o=n.getState().columnFilters)==null?void 0:o.findIndex(i=>i.id===e.id))!=null?t:-1},e.setFilterValue=t=>{n.setColumnFilters(o=>{const i=e.getFilterFn(),s=o==null?void 0:o.find(h=>h.id===e.id),a=R(t,s?s.value:void 0);if(dt(i,a,e)){var d;return(d=o==null?void 0:o.filter(h=>h.id!==e.id))!=null?d:[]}const u={id:e.id,value:a};if(s){var g;return(g=o==null?void 0:o.map(h=>h.id===e.id?u:h))!=null?g:[]}return o!=null&&o.length?[...o,u]:[u]})}},createRow:(e,n)=>{e.columnFilters={},e.columnFiltersMeta={}},createTable:e=>{e.setColumnFilters=n=>{const t=e.getAllLeafColumns(),o=i=>{var s;return(s=R(n,i))==null?void 0:s.filter(a=>{const d=t.find(u=>u.id===a.id);if(d){const u=d.getFilterFn();if(dt(u,a.value,d))return!1}return!0})};e.options.onColumnFiltersChange==null||e.options.onColumnFiltersChange(o)},e.resetColumnFilters=n=>{var t,o;e.setColumnFilters(n?[]:(t=(o=e.initialState)==null?void 0:o.columnFilters)!=null?t:[])},e.getPreFilteredRowModel=()=>e.getCoreRowModel(),e.getFilteredRowModel=()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel?e.getPreFilteredRowModel():e._getFilteredRowModel())}};function dt(e,n,t){return(e&&e.autoRemove?e.autoRemove(n,t):!1)||typeof n>"u"||typeof n=="string"&&!n}const ke={sum:(e,n,t)=>t.reduce((o,i)=>{const s=i.getValue(e);return o+(typeof s=="number"?s:0)},0),min:(e,n,t)=>{let o;return t.forEach(i=>{const s=i.getValue(e);s!=null&&(o>s||o===void 0&&s>=s)&&(o=s)}),o},max:(e,n,t)=>{let o;return t.forEach(i=>{const s=i.getValue(e);s!=null&&(o<s||o===void 0&&s>=s)&&(o=s)}),o},extent:(e,n,t)=>{let o,i;return t.forEach(s=>{const a=s.getValue(e);a!=null&&(o===void 0?a>=a&&(o=i=a):(o>a&&(o=a),i<a&&(i=a)))}),[o,i]},mean:(e,n)=>{let t=0,o=0;if(n.forEach(i=>{let s=i.getValue(e);s!=null&&(s=+s)>=s&&(++t,o+=s)}),t)return o/t},median:(e,n)=>{if(!n.length)return;const t=n.map(s=>s.getValue(e));if(!jt(t))return;if(t.length===1)return t[0];const o=Math.floor(t.length/2),i=t.sort((s,a)=>s-a);return t.length%2!==0?i[o]:(i[o-1]+i[o])/2},unique:(e,n)=>Array.from(new Set(n.map(t=>t.getValue(e))).values()),uniqueCount:(e,n)=>new Set(n.map(t=>t.getValue(e))).size,count:(e,n)=>n.length},Xt={getDefaultColumnDef:()=>({aggregatedCell:e=>{var n,t;return(n=(t=e.getValue())==null||t.toString==null?void 0:t.toString())!=null?n:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:z("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,n)=>{e.toggleGrouping=()=>{n.setGrouping(t=>t!=null&&t.includes(e.id)?t.filter(o=>o!==e.id):[...t??[],e.id])},e.getCanGroup=()=>{var t,o;return((t=e.columnDef.enableGrouping)!=null?t:!0)&&((o=n.options.enableGrouping)!=null?o:!0)&&(!!e.accessorFn||!!e.columnDef.getGroupingValue)},e.getIsGrouped=()=>{var t;return(t=n.getState().grouping)==null?void 0:t.includes(e.id)},e.getGroupedIndex=()=>{var t;return(t=n.getState().grouping)==null?void 0:t.indexOf(e.id)},e.getToggleGroupingHandler=()=>{const t=e.getCanGroup();return()=>{t&&e.toggleGrouping()}},e.getAutoAggregationFn=()=>{const t=n.getCoreRowModel().flatRows[0],o=t==null?void 0:t.getValue(e.id);if(typeof o=="number")return ke.sum;if(Object.prototype.toString.call(o)==="[object Date]")return ke.extent},e.getAggregationFn=()=>{var t,o;if(!e)throw new Error;return ge(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:e.columnDef.aggregationFn==="auto"?e.getAutoAggregationFn():(t=(o=n.options.aggregationFns)==null?void 0:o[e.columnDef.aggregationFn])!=null?t:ke[e.columnDef.aggregationFn]}},createTable:e=>{e.setGrouping=n=>e.options.onGroupingChange==null?void 0:e.options.onGroupingChange(n),e.resetGrouping=n=>{var t,o;e.setGrouping(n?[]:(t=(o=e.initialState)==null?void 0:o.grouping)!=null?t:[])},e.getPreGroupedRowModel=()=>e.getFilteredRowModel(),e.getGroupedRowModel=()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel?e.getPreGroupedRowModel():e._getGroupedRowModel())},createRow:(e,n)=>{e.getIsGrouped=()=>!!e.groupingColumnId,e.getGroupingValue=t=>{if(e._groupingValuesCache.hasOwnProperty(t))return e._groupingValuesCache[t];const o=n.getColumn(t);return o!=null&&o.columnDef.getGroupingValue?(e._groupingValuesCache[t]=o.columnDef.getGroupingValue(e.original),e._groupingValuesCache[t]):e.getValue(t)},e._groupingValuesCache={}},createCell:(e,n,t,o)=>{e.getIsGrouped=()=>n.getIsGrouped()&&n.id===t.groupingColumnId,e.getIsPlaceholder=()=>!e.getIsGrouped()&&n.getIsGrouped(),e.getIsAggregated=()=>{var i;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!!((i=t.subRows)!=null&&i.length)}}};function Zt(e,n,t){if(!(n!=null&&n.length)||!t)return e;const o=e.filter(s=>!n.includes(s.id));return t==="remove"?o:[...n.map(s=>e.find(a=>a.id===s)).filter(Boolean),...o]}const Qt={getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:z("columnOrder",e)}),createColumn:(e,n)=>{e.getIndex=N(t=>[se(n,t)],t=>t.findIndex(o=>o.id===e.id),E(n.options,"debugColumns","getIndex")),e.getIsFirstColumn=t=>{var o;return((o=se(n,t)[0])==null?void 0:o.id)===e.id},e.getIsLastColumn=t=>{var o;const i=se(n,t);return((o=i[i.length-1])==null?void 0:o.id)===e.id}},createTable:e=>{e.setColumnOrder=n=>e.options.onColumnOrderChange==null?void 0:e.options.onColumnOrderChange(n),e.resetColumnOrder=n=>{var t;e.setColumnOrder(n?[]:(t=e.initialState.columnOrder)!=null?t:[])},e._getOrderColumnsFn=N(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(n,t,o)=>i=>{let s=[];if(!(n!=null&&n.length))s=i;else{const a=[...n],d=[...i];for(;d.length&&a.length;){const u=a.shift(),g=d.findIndex(h=>h.id===u);g>-1&&s.push(d.splice(g,1)[0])}s=[...s,...d]}return Zt(s,t,o)},E(e.options,"debugTable","_getOrderColumnsFn"))}},Fe=()=>({left:[],right:[]}),en={getInitialState:e=>({columnPinning:Fe(),...e}),getDefaultOptions:e=>({onColumnPinningChange:z("columnPinning",e)}),createColumn:(e,n)=>{e.pin=t=>{const o=e.getLeafColumns().map(i=>i.id).filter(Boolean);n.setColumnPinning(i=>{var s,a;if(t==="right"){var d,u;return{left:((d=i==null?void 0:i.left)!=null?d:[]).filter(f=>!(o!=null&&o.includes(f))),right:[...((u=i==null?void 0:i.right)!=null?u:[]).filter(f=>!(o!=null&&o.includes(f))),...o]}}if(t==="left"){var g,h;return{left:[...((g=i==null?void 0:i.left)!=null?g:[]).filter(f=>!(o!=null&&o.includes(f))),...o],right:((h=i==null?void 0:i.right)!=null?h:[]).filter(f=>!(o!=null&&o.includes(f)))}}return{left:((s=i==null?void 0:i.left)!=null?s:[]).filter(f=>!(o!=null&&o.includes(f))),right:((a=i==null?void 0:i.right)!=null?a:[]).filter(f=>!(o!=null&&o.includes(f)))}})},e.getCanPin=()=>e.getLeafColumns().some(o=>{var i,s,a;return((i=o.columnDef.enablePinning)!=null?i:!0)&&((s=(a=n.options.enableColumnPinning)!=null?a:n.options.enablePinning)!=null?s:!0)}),e.getIsPinned=()=>{const t=e.getLeafColumns().map(d=>d.id),{left:o,right:i}=n.getState().columnPinning,s=t.some(d=>o==null?void 0:o.includes(d)),a=t.some(d=>i==null?void 0:i.includes(d));return s?"left":a?"right":!1},e.getPinnedIndex=()=>{var t,o;const i=e.getIsPinned();return i?(t=(o=n.getState().columnPinning)==null||(o=o[i])==null?void 0:o.indexOf(e.id))!=null?t:-1:0}},createRow:(e,n)=>{e.getCenterVisibleCells=N(()=>[e._getAllVisibleCells(),n.getState().columnPinning.left,n.getState().columnPinning.right],(t,o,i)=>{const s=[...o??[],...i??[]];return t.filter(a=>!s.includes(a.column.id))},E(n.options,"debugRows","getCenterVisibleCells")),e.getLeftVisibleCells=N(()=>[e._getAllVisibleCells(),n.getState().columnPinning.left],(t,o)=>(o??[]).map(s=>t.find(a=>a.column.id===s)).filter(Boolean).map(s=>({...s,position:"left"})),E(n.options,"debugRows","getLeftVisibleCells")),e.getRightVisibleCells=N(()=>[e._getAllVisibleCells(),n.getState().columnPinning.right],(t,o)=>(o??[]).map(s=>t.find(a=>a.column.id===s)).filter(Boolean).map(s=>({...s,position:"right"})),E(n.options,"debugRows","getRightVisibleCells"))},createTable:e=>{e.setColumnPinning=n=>e.options.onColumnPinningChange==null?void 0:e.options.onColumnPinningChange(n),e.resetColumnPinning=n=>{var t,o;return e.setColumnPinning(n?Fe():(t=(o=e.initialState)==null?void 0:o.columnPinning)!=null?t:Fe())},e.getIsSomeColumnsPinned=n=>{var t;const o=e.getState().columnPinning;if(!n){var i,s;return!!((i=o.left)!=null&&i.length||(s=o.right)!=null&&s.length)}return!!((t=o[n])!=null&&t.length)},e.getLeftLeafColumns=N(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(n,t)=>(t??[]).map(o=>n.find(i=>i.id===o)).filter(Boolean),E(e.options,"debugColumns","getLeftLeafColumns")),e.getRightLeafColumns=N(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(n,t)=>(t??[]).map(o=>n.find(i=>i.id===o)).filter(Boolean),E(e.options,"debugColumns","getRightLeafColumns")),e.getCenterLeafColumns=N(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,o)=>{const i=[...t??[],...o??[]];return n.filter(s=>!i.includes(s.id))},E(e.options,"debugColumns","getCenterLeafColumns"))}};function tn(e){return e||(typeof document<"u"?document:null)}const fe={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},Me=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),nn={getDefaultColumnDef:()=>fe,getInitialState:e=>({columnSizing:{},columnSizingInfo:Me(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:z("columnSizing",e),onColumnSizingInfoChange:z("columnSizingInfo",e)}),createColumn:(e,n)=>{e.getSize=()=>{var t,o,i;const s=n.getState().columnSizing[e.id];return Math.min(Math.max((t=e.columnDef.minSize)!=null?t:fe.minSize,(o=s??e.columnDef.size)!=null?o:fe.size),(i=e.columnDef.maxSize)!=null?i:fe.maxSize)},e.getStart=N(t=>[t,se(n,t),n.getState().columnSizing],(t,o)=>o.slice(0,e.getIndex(t)).reduce((i,s)=>i+s.getSize(),0),E(n.options,"debugColumns","getStart")),e.getAfter=N(t=>[t,se(n,t),n.getState().columnSizing],(t,o)=>o.slice(e.getIndex(t)+1).reduce((i,s)=>i+s.getSize(),0),E(n.options,"debugColumns","getAfter")),e.resetSize=()=>{n.setColumnSizing(t=>{let{[e.id]:o,...i}=t;return i})},e.getCanResize=()=>{var t,o;return((t=e.columnDef.enableResizing)!=null?t:!0)&&((o=n.options.enableColumnResizing)!=null?o:!0)},e.getIsResizing=()=>n.getState().columnSizingInfo.isResizingColumn===e.id},createHeader:(e,n)=>{e.getSize=()=>{let t=0;const o=i=>{if(i.subHeaders.length)i.subHeaders.forEach(o);else{var s;t+=(s=i.column.getSize())!=null?s:0}};return o(e),t},e.getStart=()=>{if(e.index>0){const t=e.headerGroup.headers[e.index-1];return t.getStart()+t.getSize()}return 0},e.getResizeHandler=t=>{const o=n.getColumn(e.column.id),i=o==null?void 0:o.getCanResize();return s=>{if(!o||!i||(s.persist==null||s.persist(),Te(s)&&s.touches&&s.touches.length>1))return;const a=e.getSize(),d=e?e.getLeafHeaders().map(x=>[x.column.id,x.column.getSize()]):[[o.id,o.getSize()]],u=Te(s)?Math.round(s.touches[0].clientX):s.clientX,g={},h=(x,w)=>{typeof w=="number"&&(n.setColumnSizingInfo(S=>{var F,C;const T=n.options.columnResizeDirection==="rtl"?-1:1,V=(w-((F=S==null?void 0:S.startOffset)!=null?F:0))*T,L=Math.max(V/((C=S==null?void 0:S.startSize)!=null?C:0),-.999999);return S.columnSizingStart.forEach(M=>{let[P,H]=M;g[P]=Math.round(Math.max(H+H*L,0)*100)/100}),{...S,deltaOffset:V,deltaPercentage:L}}),(n.options.columnResizeMode==="onChange"||x==="end")&&n.setColumnSizing(S=>({...S,...g})))},f=x=>h("move",x),c=x=>{h("end",x),n.setColumnSizingInfo(w=>({...w,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},l=tn(t),p={moveHandler:x=>f(x.clientX),upHandler:x=>{l==null||l.removeEventListener("mousemove",p.moveHandler),l==null||l.removeEventListener("mouseup",p.upHandler),c(x.clientX)}},m={moveHandler:x=>(x.cancelable&&(x.preventDefault(),x.stopPropagation()),f(x.touches[0].clientX),!1),upHandler:x=>{var w;l==null||l.removeEventListener("touchmove",m.moveHandler),l==null||l.removeEventListener("touchend",m.upHandler),x.cancelable&&(x.preventDefault(),x.stopPropagation()),c((w=x.touches[0])==null?void 0:w.clientX)}},b=on()?{passive:!1}:!1;Te(s)?(l==null||l.addEventListener("touchmove",m.moveHandler,b),l==null||l.addEventListener("touchend",m.upHandler,b)):(l==null||l.addEventListener("mousemove",p.moveHandler,b),l==null||l.addEventListener("mouseup",p.upHandler,b)),n.setColumnSizingInfo(x=>({...x,startOffset:u,startSize:a,deltaOffset:0,deltaPercentage:0,columnSizingStart:d,isResizingColumn:o.id}))}}},createTable:e=>{e.setColumnSizing=n=>e.options.onColumnSizingChange==null?void 0:e.options.onColumnSizingChange(n),e.setColumnSizingInfo=n=>e.options.onColumnSizingInfoChange==null?void 0:e.options.onColumnSizingInfoChange(n),e.resetColumnSizing=n=>{var t;e.setColumnSizing(n?{}:(t=e.initialState.columnSizing)!=null?t:{})},e.resetHeaderSizeInfo=n=>{var t;e.setColumnSizingInfo(n?Me():(t=e.initialState.columnSizingInfo)!=null?t:Me())},e.getTotalSize=()=>{var n,t;return(n=(t=e.getHeaderGroups()[0])==null?void 0:t.headers.reduce((o,i)=>o+i.getSize(),0))!=null?n:0},e.getLeftTotalSize=()=>{var n,t;return(n=(t=e.getLeftHeaderGroups()[0])==null?void 0:t.headers.reduce((o,i)=>o+i.getSize(),0))!=null?n:0},e.getCenterTotalSize=()=>{var n,t;return(n=(t=e.getCenterHeaderGroups()[0])==null?void 0:t.headers.reduce((o,i)=>o+i.getSize(),0))!=null?n:0},e.getRightTotalSize=()=>{var n,t;return(n=(t=e.getRightHeaderGroups()[0])==null?void 0:t.headers.reduce((o,i)=>o+i.getSize(),0))!=null?n:0}}};let he=null;function on(){if(typeof he=="boolean")return he;let e=!1;try{const n={get passive(){return e=!0,!1}},t=()=>{};window.addEventListener("test",t,n),window.removeEventListener("test",t)}catch{e=!1}return he=e,he}function Te(e){return e.type==="touchstart"}const rn={getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:z("columnVisibility",e)}),createColumn:(e,n)=>{e.toggleVisibility=t=>{e.getCanHide()&&n.setColumnVisibility(o=>({...o,[e.id]:t??!e.getIsVisible()}))},e.getIsVisible=()=>{var t,o;const i=e.columns;return(t=i.length?i.some(s=>s.getIsVisible()):(o=n.getState().columnVisibility)==null?void 0:o[e.id])!=null?t:!0},e.getCanHide=()=>{var t,o;return((t=e.columnDef.enableHiding)!=null?t:!0)&&((o=n.options.enableHiding)!=null?o:!0)},e.getToggleVisibilityHandler=()=>t=>{e.toggleVisibility==null||e.toggleVisibility(t.target.checked)}},createRow:(e,n)=>{e._getAllVisibleCells=N(()=>[e.getAllCells(),n.getState().columnVisibility],t=>t.filter(o=>o.column.getIsVisible()),E(n.options,"debugRows","_getAllVisibleCells")),e.getVisibleCells=N(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(t,o,i)=>[...t,...o,...i],E(n.options,"debugRows","getVisibleCells"))},createTable:e=>{const n=(t,o)=>N(()=>[o(),o().filter(i=>i.getIsVisible()).map(i=>i.id).join("_")],i=>i.filter(s=>s.getIsVisible==null?void 0:s.getIsVisible()),E(e.options,"debugColumns",t));e.getVisibleFlatColumns=n("getVisibleFlatColumns",()=>e.getAllFlatColumns()),e.getVisibleLeafColumns=n("getVisibleLeafColumns",()=>e.getAllLeafColumns()),e.getLeftVisibleLeafColumns=n("getLeftVisibleLeafColumns",()=>e.getLeftLeafColumns()),e.getRightVisibleLeafColumns=n("getRightVisibleLeafColumns",()=>e.getRightLeafColumns()),e.getCenterVisibleLeafColumns=n("getCenterVisibleLeafColumns",()=>e.getCenterLeafColumns()),e.setColumnVisibility=t=>e.options.onColumnVisibilityChange==null?void 0:e.options.onColumnVisibilityChange(t),e.resetColumnVisibility=t=>{var o;e.setColumnVisibility(t?{}:(o=e.initialState.columnVisibility)!=null?o:{})},e.toggleAllColumnsVisible=t=>{var o;t=(o=t)!=null?o:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((i,s)=>({...i,[s.id]:t||!(s.getCanHide!=null&&s.getCanHide())}),{}))},e.getIsAllColumnsVisible=()=>!e.getAllLeafColumns().some(t=>!(t.getIsVisible!=null&&t.getIsVisible())),e.getIsSomeColumnsVisible=()=>e.getAllLeafColumns().some(t=>t.getIsVisible==null?void 0:t.getIsVisible()),e.getToggleAllColumnsVisibilityHandler=()=>t=>{var o;e.toggleAllColumnsVisible((o=t.target)==null?void 0:o.checked)}}};function se(e,n){return n?n==="center"?e.getCenterVisibleLeafColumns():n==="left"?e.getLeftVisibleLeafColumns():e.getRightVisibleLeafColumns():e.getVisibleLeafColumns()}const sn={createTable:e=>{e._getGlobalFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),e.getGlobalFacetedRowModel=()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),e._getGlobalFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),e.getGlobalFacetedUniqueValues=()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,e._getGlobalFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),e.getGlobalFacetedMinMaxValues=()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}}},an={getInitialState:e=>({globalFilter:void 0,...e}),getDefaultOptions:e=>({onGlobalFilterChange:z("globalFilter",e),globalFilterFn:"auto",getColumnCanGlobalFilter:n=>{var t;const o=(t=e.getCoreRowModel().flatRows[0])==null||(t=t._getAllCellsByColumnId()[n.id])==null?void 0:t.getValue();return typeof o=="string"||typeof o=="number"}}),createColumn:(e,n)=>{e.getCanGlobalFilter=()=>{var t,o,i,s;return((t=e.columnDef.enableGlobalFilter)!=null?t:!0)&&((o=n.options.enableGlobalFilter)!=null?o:!0)&&((i=n.options.enableFilters)!=null?i:!0)&&((s=n.options.getColumnCanGlobalFilter==null?void 0:n.options.getColumnCanGlobalFilter(e))!=null?s:!0)&&!!e.accessorFn}},createTable:e=>{e.getGlobalAutoFilterFn=()=>K.includesString,e.getGlobalFilterFn=()=>{var n,t;const{globalFilterFn:o}=e.options;return ge(o)?o:o==="auto"?e.getGlobalAutoFilterFn():(n=(t=e.options.filterFns)==null?void 0:t[o])!=null?n:K[o]},e.setGlobalFilter=n=>{e.options.onGlobalFilterChange==null||e.options.onGlobalFilterChange(n)},e.resetGlobalFilter=n=>{e.setGlobalFilter(n?void 0:e.initialState.globalFilter)}}},ln={getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:z("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let n=!1,t=!1;e._autoResetExpanded=()=>{var o,i;if(!n){e._queue(()=>{n=!0});return}if((o=(i=e.options.autoResetAll)!=null?i:e.options.autoResetExpanded)!=null?o:!e.options.manualExpanding){if(t)return;t=!0,e._queue(()=>{e.resetExpanded(),t=!1})}},e.setExpanded=o=>e.options.onExpandedChange==null?void 0:e.options.onExpandedChange(o),e.toggleAllRowsExpanded=o=>{o??!e.getIsAllRowsExpanded()?e.setExpanded(!0):e.setExpanded({})},e.resetExpanded=o=>{var i,s;e.setExpanded(o?{}:(i=(s=e.initialState)==null?void 0:s.expanded)!=null?i:{})},e.getCanSomeRowsExpand=()=>e.getPrePaginationRowModel().flatRows.some(o=>o.getCanExpand()),e.getToggleAllRowsExpandedHandler=()=>o=>{o.persist==null||o.persist(),e.toggleAllRowsExpanded()},e.getIsSomeRowsExpanded=()=>{const o=e.getState().expanded;return o===!0||Object.values(o).some(Boolean)},e.getIsAllRowsExpanded=()=>{const o=e.getState().expanded;return typeof o=="boolean"?o===!0:!(!Object.keys(o).length||e.getRowModel().flatRows.some(i=>!i.getIsExpanded()))},e.getExpandedDepth=()=>{let o=0;return(e.getState().expanded===!0?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(s=>{const a=s.split(".");o=Math.max(o,a.length)}),o},e.getPreExpandedRowModel=()=>e.getSortedRowModel(),e.getExpandedRowModel=()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel?e.getPreExpandedRowModel():e._getExpandedRowModel())},createRow:(e,n)=>{e.toggleExpanded=t=>{n.setExpanded(o=>{var i;const s=o===!0?!0:!!(o!=null&&o[e.id]);let a={};if(o===!0?Object.keys(n.getRowModel().rowsById).forEach(d=>{a[d]=!0}):a=o,t=(i=t)!=null?i:!s,!s&&t)return{...a,[e.id]:!0};if(s&&!t){const{[e.id]:d,...u}=a;return u}return o})},e.getIsExpanded=()=>{var t;const o=n.getState().expanded;return!!((t=n.options.getIsRowExpanded==null?void 0:n.options.getIsRowExpanded(e))!=null?t:o===!0||o!=null&&o[e.id])},e.getCanExpand=()=>{var t,o,i;return(t=n.options.getRowCanExpand==null?void 0:n.options.getRowCanExpand(e))!=null?t:((o=n.options.enableExpanding)!=null?o:!0)&&!!((i=e.subRows)!=null&&i.length)},e.getIsAllParentsExpanded=()=>{let t=!0,o=e;for(;t&&o.parentId;)o=n.getRow(o.parentId,!0),t=o.getIsExpanded();return t},e.getToggleExpandedHandler=()=>{const t=e.getCanExpand();return()=>{t&&e.toggleExpanded()}}}},Ae=0,De=10,Pe=()=>({pageIndex:Ae,pageSize:De}),dn={getInitialState:e=>({...e,pagination:{...Pe(),...e==null?void 0:e.pagination}}),getDefaultOptions:e=>({onPaginationChange:z("pagination",e)}),createTable:e=>{let n=!1,t=!1;e._autoResetPageIndex=()=>{var o,i;if(!n){e._queue(()=>{n=!0});return}if((o=(i=e.options.autoResetAll)!=null?i:e.options.autoResetPageIndex)!=null?o:!e.options.manualPagination){if(t)return;t=!0,e._queue(()=>{e.resetPageIndex(),t=!1})}},e.setPagination=o=>{const i=s=>R(o,s);return e.options.onPaginationChange==null?void 0:e.options.onPaginationChange(i)},e.resetPagination=o=>{var i;e.setPagination(o?Pe():(i=e.initialState.pagination)!=null?i:Pe())},e.setPageIndex=o=>{e.setPagination(i=>{let s=R(o,i.pageIndex);const a=typeof e.options.pageCount>"u"||e.options.pageCount===-1?Number.MAX_SAFE_INTEGER:e.options.pageCount-1;return s=Math.max(0,Math.min(s,a)),{...i,pageIndex:s}})},e.resetPageIndex=o=>{var i,s;e.setPageIndex(o?Ae:(i=(s=e.initialState)==null||(s=s.pagination)==null?void 0:s.pageIndex)!=null?i:Ae)},e.resetPageSize=o=>{var i,s;e.setPageSize(o?De:(i=(s=e.initialState)==null||(s=s.pagination)==null?void 0:s.pageSize)!=null?i:De)},e.setPageSize=o=>{e.setPagination(i=>{const s=Math.max(1,R(o,i.pageSize)),a=i.pageSize*i.pageIndex,d=Math.floor(a/s);return{...i,pageIndex:d,pageSize:s}})},e.setPageCount=o=>e.setPagination(i=>{var s;let a=R(o,(s=e.options.pageCount)!=null?s:-1);return typeof a=="number"&&(a=Math.max(-1,a)),{...i,pageCount:a}}),e.getPageOptions=N(()=>[e.getPageCount()],o=>{let i=[];return o&&o>0&&(i=[...new Array(o)].fill(null).map((s,a)=>a)),i},E(e.options,"debugTable","getPageOptions")),e.getCanPreviousPage=()=>e.getState().pagination.pageIndex>0,e.getCanNextPage=()=>{const{pageIndex:o}=e.getState().pagination,i=e.getPageCount();return i===-1?!0:i===0?!1:o<i-1},e.previousPage=()=>e.setPageIndex(o=>o-1),e.nextPage=()=>e.setPageIndex(o=>o+1),e.firstPage=()=>e.setPageIndex(0),e.lastPage=()=>e.setPageIndex(e.getPageCount()-1),e.getPrePaginationRowModel=()=>e.getExpandedRowModel(),e.getPaginationRowModel=()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel?e.getPrePaginationRowModel():e._getPaginationRowModel()),e.getPageCount=()=>{var o;return(o=e.options.pageCount)!=null?o:Math.ceil(e.getRowCount()/e.getState().pagination.pageSize)},e.getRowCount=()=>{var o;return(o=e.options.rowCount)!=null?o:e.getPrePaginationRowModel().rows.length}}},$e=()=>({top:[],bottom:[]}),cn={getInitialState:e=>({rowPinning:$e(),...e}),getDefaultOptions:e=>({onRowPinningChange:z("rowPinning",e)}),createRow:(e,n)=>{e.pin=(t,o,i)=>{const s=o?e.getLeafRows().map(u=>{let{id:g}=u;return g}):[],a=i?e.getParentRows().map(u=>{let{id:g}=u;return g}):[],d=new Set([...a,e.id,...s]);n.setRowPinning(u=>{var g,h;if(t==="bottom"){var f,c;return{top:((f=u==null?void 0:u.top)!=null?f:[]).filter(m=>!(d!=null&&d.has(m))),bottom:[...((c=u==null?void 0:u.bottom)!=null?c:[]).filter(m=>!(d!=null&&d.has(m))),...Array.from(d)]}}if(t==="top"){var l,p;return{top:[...((l=u==null?void 0:u.top)!=null?l:[]).filter(m=>!(d!=null&&d.has(m))),...Array.from(d)],bottom:((p=u==null?void 0:u.bottom)!=null?p:[]).filter(m=>!(d!=null&&d.has(m)))}}return{top:((g=u==null?void 0:u.top)!=null?g:[]).filter(m=>!(d!=null&&d.has(m))),bottom:((h=u==null?void 0:u.bottom)!=null?h:[]).filter(m=>!(d!=null&&d.has(m)))}})},e.getCanPin=()=>{var t;const{enableRowPinning:o,enablePinning:i}=n.options;return typeof o=="function"?o(e):(t=o??i)!=null?t:!0},e.getIsPinned=()=>{const t=[e.id],{top:o,bottom:i}=n.getState().rowPinning,s=t.some(d=>o==null?void 0:o.includes(d)),a=t.some(d=>i==null?void 0:i.includes(d));return s?"top":a?"bottom":!1},e.getPinnedIndex=()=>{var t,o;const i=e.getIsPinned();if(!i)return-1;const s=(t=i==="top"?n.getTopRows():n.getBottomRows())==null?void 0:t.map(a=>{let{id:d}=a;return d});return(o=s==null?void 0:s.indexOf(e.id))!=null?o:-1}},createTable:e=>{e.setRowPinning=n=>e.options.onRowPinningChange==null?void 0:e.options.onRowPinningChange(n),e.resetRowPinning=n=>{var t,o;return e.setRowPinning(n?$e():(t=(o=e.initialState)==null?void 0:o.rowPinning)!=null?t:$e())},e.getIsSomeRowsPinned=n=>{var t;const o=e.getState().rowPinning;if(!n){var i,s;return!!((i=o.top)!=null&&i.length||(s=o.bottom)!=null&&s.length)}return!!((t=o[n])!=null&&t.length)},e._getPinnedRows=(n,t,o)=>{var i;return((i=e.options.keepPinnedRows)==null||i?(t??[]).map(a=>{const d=e.getRow(a,!0);return d.getIsAllParentsExpanded()?d:null}):(t??[]).map(a=>n.find(d=>d.id===a))).filter(Boolean).map(a=>({...a,position:o}))},e.getTopRows=N(()=>[e.getRowModel().rows,e.getState().rowPinning.top],(n,t)=>e._getPinnedRows(n,t,"top"),E(e.options,"debugRows","getTopRows")),e.getBottomRows=N(()=>[e.getRowModel().rows,e.getState().rowPinning.bottom],(n,t)=>e._getPinnedRows(n,t,"bottom"),E(e.options,"debugRows","getBottomRows")),e.getCenterRows=N(()=>[e.getRowModel().rows,e.getState().rowPinning.top,e.getState().rowPinning.bottom],(n,t,o)=>{const i=new Set([...t??[],...o??[]]);return n.filter(s=>!i.has(s.id))},E(e.options,"debugRows","getCenterRows"))}},un={getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:z("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>{e.setRowSelection=n=>e.options.onRowSelectionChange==null?void 0:e.options.onRowSelectionChange(n),e.resetRowSelection=n=>{var t;return e.setRowSelection(n?{}:(t=e.initialState.rowSelection)!=null?t:{})},e.toggleAllRowsSelected=n=>{e.setRowSelection(t=>{n=typeof n<"u"?n:!e.getIsAllRowsSelected();const o={...t},i=e.getPreGroupedRowModel().flatRows;return n?i.forEach(s=>{s.getCanSelect()&&(o[s.id]=!0)}):i.forEach(s=>{delete o[s.id]}),o})},e.toggleAllPageRowsSelected=n=>e.setRowSelection(t=>{const o=typeof n<"u"?n:!e.getIsAllPageRowsSelected(),i={...t};return e.getRowModel().rows.forEach(s=>{Oe(i,s.id,o,!0,e)}),i}),e.getPreSelectedRowModel=()=>e.getCoreRowModel(),e.getSelectedRowModel=N(()=>[e.getState().rowSelection,e.getCoreRowModel()],(n,t)=>Object.keys(n).length?Le(e,t):{rows:[],flatRows:[],rowsById:{}},E(e.options,"debugTable","getSelectedRowModel")),e.getFilteredSelectedRowModel=N(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(n,t)=>Object.keys(n).length?Le(e,t):{rows:[],flatRows:[],rowsById:{}},E(e.options,"debugTable","getFilteredSelectedRowModel")),e.getGroupedSelectedRowModel=N(()=>[e.getState().rowSelection,e.getSortedRowModel()],(n,t)=>Object.keys(n).length?Le(e,t):{rows:[],flatRows:[],rowsById:{}},E(e.options,"debugTable","getGroupedSelectedRowModel")),e.getIsAllRowsSelected=()=>{const n=e.getFilteredRowModel().flatRows,{rowSelection:t}=e.getState();let o=!!(n.length&&Object.keys(t).length);return o&&n.some(i=>i.getCanSelect()&&!t[i.id])&&(o=!1),o},e.getIsAllPageRowsSelected=()=>{const n=e.getPaginationRowModel().flatRows.filter(i=>i.getCanSelect()),{rowSelection:t}=e.getState();let o=!!n.length;return o&&n.some(i=>!t[i.id])&&(o=!1),o},e.getIsSomeRowsSelected=()=>{var n;const t=Object.keys((n=e.getState().rowSelection)!=null?n:{}).length;return t>0&&t<e.getFilteredRowModel().flatRows.length},e.getIsSomePageRowsSelected=()=>{const n=e.getPaginationRowModel().flatRows;return e.getIsAllPageRowsSelected()?!1:n.filter(t=>t.getCanSelect()).some(t=>t.getIsSelected()||t.getIsSomeSelected())},e.getToggleAllRowsSelectedHandler=()=>n=>{e.toggleAllRowsSelected(n.target.checked)},e.getToggleAllPageRowsSelectedHandler=()=>n=>{e.toggleAllPageRowsSelected(n.target.checked)}},createRow:(e,n)=>{e.toggleSelected=(t,o)=>{const i=e.getIsSelected();n.setRowSelection(s=>{var a;if(t=typeof t<"u"?t:!i,e.getCanSelect()&&i===t)return s;const d={...s};return Oe(d,e.id,t,(a=o==null?void 0:o.selectChildren)!=null?a:!0,n),d})},e.getIsSelected=()=>{const{rowSelection:t}=n.getState();return Ve(e,t)},e.getIsSomeSelected=()=>{const{rowSelection:t}=n.getState();return qe(e,t)==="some"},e.getIsAllSubRowsSelected=()=>{const{rowSelection:t}=n.getState();return qe(e,t)==="all"},e.getCanSelect=()=>{var t;return typeof n.options.enableRowSelection=="function"?n.options.enableRowSelection(e):(t=n.options.enableRowSelection)!=null?t:!0},e.getCanSelectSubRows=()=>{var t;return typeof n.options.enableSubRowSelection=="function"?n.options.enableSubRowSelection(e):(t=n.options.enableSubRowSelection)!=null?t:!0},e.getCanMultiSelect=()=>{var t;return typeof n.options.enableMultiRowSelection=="function"?n.options.enableMultiRowSelection(e):(t=n.options.enableMultiRowSelection)!=null?t:!0},e.getToggleSelectedHandler=()=>{const t=e.getCanSelect();return o=>{var i;t&&e.toggleSelected((i=o.target)==null?void 0:i.checked)}}}},Oe=(e,n,t,o,i)=>{var s;const a=i.getRow(n,!0);t?(a.getCanMultiSelect()||Object.keys(e).forEach(d=>delete e[d]),a.getCanSelect()&&(e[n]=!0)):delete e[n],o&&(s=a.subRows)!=null&&s.length&&a.getCanSelectSubRows()&&a.subRows.forEach(d=>Oe(e,d.id,t,o,i))};function Le(e,n){const t=e.getState().rowSelection,o=[],i={},s=function(a,d){return a.map(u=>{var g;const h=Ve(u,t);if(h&&(o.push(u),i[u.id]=u),(g=u.subRows)!=null&&g.length&&(u={...u,subRows:s(u.subRows)}),h)return u}).filter(Boolean)};return{rows:s(n.rows),flatRows:o,rowsById:i}}function Ve(e,n){var t;return(t=n[e.id])!=null?t:!1}function qe(e,n,t){var o;if(!((o=e.subRows)!=null&&o.length))return!1;let i=!0,s=!1;return e.subRows.forEach(a=>{if(!(s&&!i)&&(a.getCanSelect()&&(Ve(a,n)?s=!0:i=!1),a.subRows&&a.subRows.length)){const d=qe(a,n);d==="all"?s=!0:(d==="some"&&(s=!0),i=!1)}}),i?"all":s?"some":!1}const He=/([0-9]+)/gm,gn=(e,n,t)=>ct(Y(e.getValue(t)).toLowerCase(),Y(n.getValue(t)).toLowerCase()),pn=(e,n,t)=>ct(Y(e.getValue(t)),Y(n.getValue(t))),fn=(e,n,t)=>ze(Y(e.getValue(t)).toLowerCase(),Y(n.getValue(t)).toLowerCase()),hn=(e,n,t)=>ze(Y(e.getValue(t)),Y(n.getValue(t))),mn=(e,n,t)=>{const o=e.getValue(t),i=n.getValue(t);return o>i?1:o<i?-1:0},yn=(e,n,t)=>ze(e.getValue(t),n.getValue(t));function ze(e,n){return e===n?0:e>n?1:-1}function Y(e){return typeof e=="number"?isNaN(e)||e===1/0||e===-1/0?"":String(e):typeof e=="string"?e:""}function ct(e,n){const t=e.split(He).filter(Boolean),o=n.split(He).filter(Boolean);for(;t.length&&o.length;){const i=t.shift(),s=o.shift(),a=parseInt(i,10),d=parseInt(s,10),u=[a,d].sort();if(isNaN(u[0])){if(i>s)return 1;if(s>i)return-1;continue}if(isNaN(u[1]))return isNaN(a)?-1:1;if(a>d)return 1;if(d>a)return-1}return t.length-o.length}const ae={alphanumeric:gn,alphanumericCaseSensitive:pn,text:fn,textCaseSensitive:hn,datetime:mn,basic:yn},bn=[Jt,rn,Qt,en,Rt,Yt,sn,an,{getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:z("sorting",e),isMultiSortEvent:n=>n.shiftKey}),createColumn:(e,n)=>{e.getAutoSortingFn=()=>{const t=n.getFilteredRowModel().flatRows.slice(10);let o=!1;for(const i of t){const s=i==null?void 0:i.getValue(e.id);if(Object.prototype.toString.call(s)==="[object Date]")return ae.datetime;if(typeof s=="string"&&(o=!0,s.split(He).length>1))return ae.alphanumeric}return o?ae.text:ae.basic},e.getAutoSortDir=()=>{const t=n.getFilteredRowModel().flatRows[0];return typeof(t==null?void 0:t.getValue(e.id))=="string"?"asc":"desc"},e.getSortingFn=()=>{var t,o;if(!e)throw new Error;return ge(e.columnDef.sortingFn)?e.columnDef.sortingFn:e.columnDef.sortingFn==="auto"?e.getAutoSortingFn():(t=(o=n.options.sortingFns)==null?void 0:o[e.columnDef.sortingFn])!=null?t:ae[e.columnDef.sortingFn]},e.toggleSorting=(t,o)=>{const i=e.getNextSortingOrder(),s=typeof t<"u"&&t!==null;n.setSorting(a=>{const d=a==null?void 0:a.find(l=>l.id===e.id),u=a==null?void 0:a.findIndex(l=>l.id===e.id);let g=[],h,f=s?t:i==="desc";if(a!=null&&a.length&&e.getCanMultiSort()&&o?d?h="toggle":h="add":a!=null&&a.length&&u!==a.length-1?h="replace":d?h="toggle":h="replace",h==="toggle"&&(s||i||(h="remove")),h==="add"){var c;g=[...a,{id:e.id,desc:f}],g.splice(0,g.length-((c=n.options.maxMultiSortColCount)!=null?c:Number.MAX_SAFE_INTEGER))}else h==="toggle"?g=a.map(l=>l.id===e.id?{...l,desc:f}:l):h==="remove"?g=a.filter(l=>l.id!==e.id):g=[{id:e.id,desc:f}];return g})},e.getFirstSortDir=()=>{var t,o;return((t=(o=e.columnDef.sortDescFirst)!=null?o:n.options.sortDescFirst)!=null?t:e.getAutoSortDir()==="desc")?"desc":"asc"},e.getNextSortingOrder=t=>{var o,i;const s=e.getFirstSortDir(),a=e.getIsSorted();return a?a!==s&&((o=n.options.enableSortingRemoval)==null||o)&&(!(t&&(i=n.options.enableMultiRemove)!=null)||i)?!1:a==="desc"?"asc":"desc":s},e.getCanSort=()=>{var t,o;return((t=e.columnDef.enableSorting)!=null?t:!0)&&((o=n.options.enableSorting)!=null?o:!0)&&!!e.accessorFn},e.getCanMultiSort=()=>{var t,o;return(t=(o=e.columnDef.enableMultiSort)!=null?o:n.options.enableMultiSort)!=null?t:!!e.accessorFn},e.getIsSorted=()=>{var t;const o=(t=n.getState().sorting)==null?void 0:t.find(i=>i.id===e.id);return o?o.desc?"desc":"asc":!1},e.getSortIndex=()=>{var t,o;return(t=(o=n.getState().sorting)==null?void 0:o.findIndex(i=>i.id===e.id))!=null?t:-1},e.clearSorting=()=>{n.setSorting(t=>t!=null&&t.length?t.filter(o=>o.id!==e.id):[])},e.getToggleSortingHandler=()=>{const t=e.getCanSort();return o=>{t&&(o.persist==null||o.persist(),e.toggleSorting==null||e.toggleSorting(void 0,e.getCanMultiSort()?n.options.isMultiSortEvent==null?void 0:n.options.isMultiSortEvent(o):!1))}}},createTable:e=>{e.setSorting=n=>e.options.onSortingChange==null?void 0:e.options.onSortingChange(n),e.resetSorting=n=>{var t,o;e.setSorting(n?[]:(t=(o=e.initialState)==null?void 0:o.sorting)!=null?t:[])},e.getPreSortedRowModel=()=>e.getGroupedRowModel(),e.getSortedRowModel=()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel?e.getPreSortedRowModel():e._getSortedRowModel())}},Xt,ln,dn,cn,un,nn];function vn(e){var n,t;X.NODE_ENV!=="production"&&(e.debugAll||e.debugTable)&&console.info("Creating Table Instance...");const o=[...bn,...(n=e._features)!=null?n:[]];let i={_features:o};const s=i._features.reduce((c,l)=>Object.assign(c,l.getDefaultOptions==null?void 0:l.getDefaultOptions(i)),{}),a=c=>i.options.mergeOptions?i.options.mergeOptions(s,c):{...s,...c};let u={...{},...(t=e.initialState)!=null?t:{}};i._features.forEach(c=>{var l;u=(l=c.getInitialState==null?void 0:c.getInitialState(u))!=null?l:u});const g=[];let h=!1;const f={_features:o,options:{...s,...e},initialState:u,_queue:c=>{g.push(c),h||(h=!0,Promise.resolve().then(()=>{for(;g.length;)g.shift()();h=!1}).catch(l=>setTimeout(()=>{throw l})))},reset:()=>{i.setState(i.initialState)},setOptions:c=>{const l=R(c,i.options);i.options=a(l)},getState:()=>i.options.state,setState:c=>{i.options.onStateChange==null||i.options.onStateChange(c)},_getRowId:(c,l,p)=>{var m;return(m=i.options.getRowId==null?void 0:i.options.getRowId(c,l,p))!=null?m:`${p?[p.id,l].join("."):l}`},getCoreRowModel:()=>(i._getCoreRowModel||(i._getCoreRowModel=i.options.getCoreRowModel(i)),i._getCoreRowModel()),getRowModel:()=>i.getPaginationRowModel(),getRow:(c,l)=>{let p=(l?i.getPrePaginationRowModel():i.getRowModel()).rowsById[c];if(!p&&(p=i.getCoreRowModel().rowsById[c],!p))throw X.NODE_ENV!=="production"?new Error(`getRow could not find row with ID: ${c}`):new Error;return p},_getDefaultColumnDef:N(()=>[i.options.defaultColumn],c=>{var l;return c=(l=c)!=null?l:{},{header:p=>{const m=p.header.column.columnDef;return m.accessorKey?m.accessorKey:m.accessorFn?m.id:null},cell:p=>{var m,b;return(m=(b=p.renderValue())==null||b.toString==null?void 0:b.toString())!=null?m:null},...i._features.reduce((p,m)=>Object.assign(p,m.getDefaultColumnDef==null?void 0:m.getDefaultColumnDef()),{}),...c}},E(e,"debugColumns","_getDefaultColumnDef")),_getColumnDefs:()=>i.options.columns,getAllColumns:N(()=>[i._getColumnDefs()],c=>{const l=function(p,m,b){return b===void 0&&(b=0),p.map(x=>{const w=Kt(i,x,b,m),S=x;return w.columns=S.columns?l(S.columns,w,b+1):[],w})};return l(c)},E(e,"debugColumns","getAllColumns")),getAllFlatColumns:N(()=>[i.getAllColumns()],c=>c.flatMap(l=>l.getFlatColumns()),E(e,"debugColumns","getAllFlatColumns")),_getAllFlatColumnsById:N(()=>[i.getAllFlatColumns()],c=>c.reduce((l,p)=>(l[p.id]=p,l),{}),E(e,"debugColumns","getAllFlatColumnsById")),getAllLeafColumns:N(()=>[i.getAllColumns(),i._getOrderColumnsFn()],(c,l)=>{let p=c.flatMap(m=>m.getLeafColumns());return l(p)},E(e,"debugColumns","getAllLeafColumns")),getColumn:c=>{const l=i._getAllFlatColumnsById()[c];return X.NODE_ENV!=="production"&&!l&&console.error(`[Table] Column with id '${c}' does not exist.`),l}};Object.assign(i,f);for(let c=0;c<i._features.length;c++){const l=i._features[c];l==null||l.createTable==null||l.createTable(i)}return i}function Ue(){return e=>N(()=>[e.options.data],n=>{const t={rows:[],flatRows:[],rowsById:{}},o=function(i,s,a){s===void 0&&(s=0);const d=[];for(let g=0;g<i.length;g++){const h=Ee(e,e._getRowId(i[g],g,a),i[g],g,s,void 0,a==null?void 0:a.id);if(t.flatRows.push(h),t.rowsById[h.id]=h,d.push(h),e.options.getSubRows){var u;h.originalSubRows=e.options.getSubRows(i[g],g),(u=h.originalSubRows)!=null&&u.length&&(h.subRows=o(h.originalSubRows,s+1,h))}}return d};return t.rows=o(n),t},E(e.options,"debugTable","getRowModel",()=>e._autoResetPageIndex()))}function xn(e){const n=[],t=o=>{var i;n.push(o),(i=o.subRows)!=null&&i.length&&o.getIsExpanded()&&o.subRows.forEach(t)};return e.rows.forEach(t),{rows:n,flatRows:e.flatRows,rowsById:e.rowsById}}function _n(e,n,t){return t.options.filterFromLeafRows?Sn(e,n,t):wn(e,n,t)}function Sn(e,n,t){var o;const i=[],s={},a=(o=t.options.maxLeafRowFilterDepth)!=null?o:100,d=function(u,g){g===void 0&&(g=0);const h=[];for(let c=0;c<u.length;c++){var f;let l=u[c];const p=Ee(t,l.id,l.original,l.index,l.depth,void 0,l.parentId);if(p.columnFilters=l.columnFilters,(f=l.subRows)!=null&&f.length&&g<a){if(p.subRows=d(l.subRows,g+1),l=p,n(l)&&!p.subRows.length){h.push(l),s[l.id]=l,i.push(l);continue}if(n(l)||p.subRows.length){h.push(l),s[l.id]=l,i.push(l);continue}}else l=p,n(l)&&(h.push(l),s[l.id]=l,i.push(l))}return h};return{rows:d(e),flatRows:i,rowsById:s}}function wn(e,n,t){var o;const i=[],s={},a=(o=t.options.maxLeafRowFilterDepth)!=null?o:100,d=function(u,g){g===void 0&&(g=0);const h=[];for(let c=0;c<u.length;c++){let l=u[c];if(n(l)){var f;if((f=l.subRows)!=null&&f.length&&g<a){const m=Ee(t,l.id,l.original,l.index,l.depth,void 0,l.parentId);m.subRows=d(l.subRows,g+1),l=m}h.push(l),i.push(l),s[l.id]=l}}return h};return{rows:d(e),flatRows:i,rowsById:s}}function Ge(){return e=>N(()=>[e.getPreFilteredRowModel(),e.getState().columnFilters,e.getState().globalFilter],(n,t,o)=>{if(!n.rows.length||!(t!=null&&t.length)&&!o){for(let c=0;c<n.flatRows.length;c++)n.flatRows[c].columnFilters={},n.flatRows[c].columnFiltersMeta={};return n}const i=[],s=[];(t??[]).forEach(c=>{var l;const p=e.getColumn(c.id);if(!p)return;const m=p.getFilterFn();if(!m){X.NODE_ENV!=="production"&&console.warn(`Could not find a valid 'column.filterFn' for column with the ID: ${p.id}.`);return}i.push({id:c.id,filterFn:m,resolvedValue:(l=m.resolveFilterValue==null?void 0:m.resolveFilterValue(c.value))!=null?l:c.value})});const a=(t??[]).map(c=>c.id),d=e.getGlobalFilterFn(),u=e.getAllLeafColumns().filter(c=>c.getCanGlobalFilter());o&&d&&u.length&&(a.push("__global__"),u.forEach(c=>{var l;s.push({id:c.id,filterFn:d,resolvedValue:(l=d.resolveFilterValue==null?void 0:d.resolveFilterValue(o))!=null?l:o})}));let g,h;for(let c=0;c<n.flatRows.length;c++){const l=n.flatRows[c];if(l.columnFilters={},i.length)for(let p=0;p<i.length;p++){g=i[p];const m=g.id;l.columnFilters[m]=g.filterFn(l,m,g.resolvedValue,b=>{l.columnFiltersMeta[m]=b})}if(s.length){for(let p=0;p<s.length;p++){h=s[p];const m=h.id;if(h.filterFn(l,m,h.resolvedValue,b=>{l.columnFiltersMeta[m]=b})){l.columnFilters.__global__=!0;break}}l.columnFilters.__global__!==!0&&(l.columnFilters.__global__=!1)}}const f=c=>{for(let l=0;l<a.length;l++)if(c.columnFilters[a[l]]===!1)return!1;return!0};return _n(n.rows,f,e)},E(e.options,"debugTable","getFilteredRowModel",()=>e._autoResetPageIndex()))}function ut(e){return n=>N(()=>[n.getState().pagination,n.getPrePaginationRowModel(),n.options.paginateExpandedRows?void 0:n.getState().expanded],(t,o)=>{if(!o.rows.length)return o;const{pageSize:i,pageIndex:s}=t;let{rows:a,flatRows:d,rowsById:u}=o;const g=i*s,h=g+i;a=a.slice(g,h);let f;n.options.paginateExpandedRows?f={rows:a,flatRows:d,rowsById:u}:f=xn({rows:a,flatRows:d,rowsById:u}),f.flatRows=[];const c=l=>{f.flatRows.push(l),l.subRows.length&&l.subRows.forEach(c)};return f.rows.forEach(c),f},E(n.options,"debugTable","getPaginationRowModel"))}function je(){return e=>N(()=>[e.getState().sorting,e.getPreSortedRowModel()],(n,t)=>{if(!t.rows.length||!(n!=null&&n.length))return t;const o=e.getState().sorting,i=[],s=o.filter(u=>{var g;return(g=e.getColumn(u.id))==null?void 0:g.getCanSort()}),a={};s.forEach(u=>{const g=e.getColumn(u.id);g&&(a[u.id]={sortUndefined:g.columnDef.sortUndefined,invertSorting:g.columnDef.invertSorting,sortingFn:g.getSortingFn()})});const d=u=>{const g=u.map(h=>({...h}));return g.sort((h,f)=>{for(let l=0;l<s.length;l+=1){var c;const p=s[l],m=a[p.id],b=m.sortUndefined,x=(c=p==null?void 0:p.desc)!=null?c:!1;let w=0;if(b){const S=h.getValue(p.id),F=f.getValue(p.id),C=S===void 0,T=F===void 0;if(C||T){if(b==="first")return C?-1:1;if(b==="last")return C?1:-1;w=C&&T?0:C?b:-b}}if(w===0&&(w=m.sortingFn(h,f,p.id)),w!==0)return x&&(w*=-1),m.invertSorting&&(w*=-1),w}return h.index-f.index}),g.forEach(h=>{var f;i.push(h),(f=h.subRows)!=null&&f.length&&(h.subRows=d(h.subRows))}),g};return{rows:d(t.rows),flatRows:i,rowsById:t.rowsById}},E(e.options,"debugTable","getSortedRowModel",()=>e._autoResetPageIndex()))}/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function ee(e,n){return e?Cn(e)?Ce.createElement(e,n):e:null}function Cn(e){return Nn(e)||typeof e=="function"||En(e)}function Nn(e){return typeof e=="function"&&(()=>{const n=Object.getPrototypeOf(e);return n.prototype&&n.prototype.isReactComponent})()}function En(e){return typeof e=="object"&&typeof e.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)}function Be(e){const n={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[t]=Ce.useState(()=>({current:vn(n)})),[o,i]=Ce.useState(()=>t.current.initialState);return t.current.setOptions(s=>({...s,...e,state:{...o,...e.state},onStateChange:a=>{i(a),e.onStateChange==null||e.onStateChange(a)}})),t.current}/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var In={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),k=(e,n)=>{const t=v.forwardRef(({color:o="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:d="",children:u,...g},h)=>v.createElement("svg",{ref:h,...In,width:i,height:i,stroke:o,strokeWidth:a?Number(s)*24/Number(i):s,className:["lucide",`lucide-${kn(e)}`,d].join(" "),...g},[...n.map(([f,c])=>v.createElement(f,c)),...Array.isArray(u)?u:[u]]));return t.displayName=`${e}`,t};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=k("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=k("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=k("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=k("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=k("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=k("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=k("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=k("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=k("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=k("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=k("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=k("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=k("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=k("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=k("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=k("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=k("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=k("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=k("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=k("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=k("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=k("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=k("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=k("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=k("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=k("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=k("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=k("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=k("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=k("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=k("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=k("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=k("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=k("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=k("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=k("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=k("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=k("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=k("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=k("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),ne=Ne(),Wn=()=>{const[e,n]=v.useState([]),[t,o]=v.useState(!0),[i,s]=v.useState([]),[a,d]=v.useState(""),[u,g]=v.useState([]),h=async()=>{o(!0);const{data:p,error:m}=await y.data.list({table:"com_hubbi_inventory_items",options:{strategy:"cache_first"}});p?n(p):m&&(console.error(m),y.notify.error("Error al cargar inventario")),o(!1)};v.useEffect(()=>{h();const p=()=>h();return y.events.on("inventory:item:created",p),y.events.on("inventory:item:updated",p),()=>{y.events.off("inventory:item:created",p),y.events.off("inventory:item:updated",p)}},[]);const f=p=>{switch(p){case"kit":return r.jsx(de,{size:18,className:"text-blue-500"});case"serialized":return r.jsx(gt,{size:18,className:"text-purple-500"});case"asset":return r.jsx(ve,{size:18,className:"text-orange-500"});default:return r.jsx(Ke,{size:18,className:"text-gray-500"})}},c=v.useMemo(()=>[ne.accessor("name",{header:"Producto",cell:p=>r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium text-gray-900",children:p.getValue()}),p.row.original.description&&r.jsx("span",{className:"text-xs text-gray-400 truncate max-w-xs",children:p.row.original.description})]})}),ne.accessor("sku",{header:"SKU",cell:p=>r.jsx("span",{className:"font-mono text-gray-600",children:p.getValue()})}),ne.accessor("type",{header:"Tipo",cell:p=>r.jsxs("div",{className:"flex items-center gap-2",title:p.getValue(),children:[f(p.getValue()),r.jsx("span",{className:"text-sm capitalize text-gray-600",children:p.getValue()})]})}),ne.accessor("weighted_average_cost",{header:()=>r.jsx("div",{className:"text-right",children:"Costo Prom."}),cell:p=>r.jsxs("div",{className:"text-right font-mono",children:["$",p.getValue().toFixed(2)]})}),ne.accessor("is_active",{header:()=>r.jsx("div",{className:"text-center",children:"Estado"}),cell:p=>r.jsx("div",{className:"text-center",children:r.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${p.getValue()?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:p.getValue()?"Activo":"Inactivo"})})}),ne.display({id:"actions",header:()=>r.jsx("div",{className:"text-right",children:"Acciones"}),cell:()=>r.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[r.jsx("button",{className:"p-1 hover:bg-gray-200 rounded text-gray-500 hover:text-blue-600",children:r.jsx(Hn,{size:16})}),r.jsx("button",{className:"p-1 hover:bg-gray-200 rounded text-gray-500 hover:text-red-600",children:r.jsx(xt,{size:16})})]})})],[]),l=Be({data:e,columns:c,state:{sorting:i,globalFilter:a,columnFilters:u},onSortingChange:s,onGlobalFilterChange:d,onColumnFiltersChange:g,getCoreRowModel:Ue(),getSortedRowModel:je(),getFilteredRowModel:Ge(),getPaginationRowModel:ut()});return r.jsxs("div",{className:"flex flex-col h-full bg-white rounded-lg shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"relative",children:[r.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),r.jsx("input",{type:"text",placeholder:"Buscar por SKU o Nombre...",className:"pl-10 pr-4 py-2 border rounded-lg text-sm w-64 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",value:a,onChange:p=>d(p.target.value)})]}),r.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[r.jsx(Ln,{size:18,className:"text-gray-400"}),r.jsxs("select",{className:"text-sm border-none bg-transparent focus:ring-0 cursor-pointer text-gray-600 font-medium",onChange:p=>{var b;const m=p.target.value;(b=l.getColumn("type"))==null||b.setFilterValue(m==="all"?void 0:m)},children:[r.jsx("option",{value:"all",children:"Todos los tipos"}),r.jsx("option",{value:"simple",children:"Simples"}),r.jsx("option",{value:"kit",children:"Kits"}),r.jsx("option",{value:"serialized",children:"Serializados"}),r.jsx("option",{value:"asset",children:"Activos (Camiones)"})]})]})]}),r.jsxs("button",{className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:[r.jsx(Re,{size:18}),"Nuevo Producto"]})]}),r.jsx("div",{className:"flex-1 overflow-auto",children:r.jsxs("table",{className:"w-full text-left border-collapse",children:[r.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:l.getHeaderGroups().map(p=>r.jsx("tr",{children:p.headers.map(m=>r.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",onClick:m.column.getToggleSortingHandler(),children:r.jsxs("div",{className:"flex items-center gap-1",children:[ee(m.column.columnDef.header,m.getContext()),m.column.getCanSort()&&r.jsx(Z,{size:12,className:"text-gray-400"})]})},m.id))},p.id))}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:t?r.jsx("tr",{children:r.jsx("td",{colSpan:c.length,className:"text-center py-12 text-gray-400",children:"Cargando inventario..."})}):l.getRowModel().rows.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:c.length,className:"text-center py-12 text-gray-400",children:"No se encontraron productos"})}):l.getRowModel().rows.map(p=>r.jsx("tr",{className:"hover:bg-gray-50/50 transition-colors group",children:p.getVisibleCells().map(m=>r.jsx("td",{className:"px-6 py-3 text-sm",children:ee(m.column.columnDef.cell,m.getContext())},m.id))},p.id))})]})}),l.getPageCount()>1&&r.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-100",children:[r.jsxs("div",{className:"text-xs text-gray-500",children:["PÃ¡gina ",l.getState().pagination.pageIndex+1," de ",l.getPageCount()]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{className:"px-3 py-1 border rounded text-xs disabled:opacity-50",onClick:()=>l.previousPage(),disabled:!l.getCanPreviousPage(),children:"Anterior"}),r.jsx("button",{className:"px-3 py-1 border rounded text-xs disabled:opacity-50",onClick:()=>l.nextPage(),disabled:!l.getCanNextPage(),children:"Siguiente"})]})]})]})},St=()=>{const[e,n]=v.useState(!1);return{createItem:async o=>{n(!0);try{const i={...o,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()},s=window.hubbi,a=await s.data.create({table:"com_hubbi_inventory_items",data:i,options:{strategy:"online_first"}});if(a.error)throw a.error;return a.offline?s.notify.warning("Guardado localmente. Se sincronizarÃ¡ al recuperar conexiÃ³n."):s.notify.success("Producto creado exitosamente."),{success:!0,data:i}}catch(i){return console.error("Error creating item:",i),window.hubbi&&window.hubbi.notify.error("Error al crear el producto: "+(i instanceof Error?i.message:String(i))),{success:!1,error:i}}finally{n(!1)}},loading:e}},Kn=({onClose:e,onSuccess:n,initialData:t})=>{const{createItem:o,loading:i}=St(),[s,a]=v.useState({type:"simple",is_active:!0,is_internal_use_only:!1,attributes:{},...t}),[d,u]=v.useState(s.attributes||{}),g=async f=>{if(f.preventDefault(),!s.sku||!s.name)return;(await o({...s,attributes:d})).success&&(n==null||n(),e())},h=()=>{switch(s.type){case"asset":return r.jsxs("div",{className:"grid grid-cols-2 gap-4 border-t border-gray-100 pt-4 mt-4",children:[r.jsxs("div",{className:"col-span-2 flex items-center gap-2 text-orange-600 mb-2",children:[r.jsx(ve,{size:18}),r.jsx("span",{className:"font-semibold text-sm",children:"Mascarilla de Activo (CamiÃ³n)"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"VIN (NÃºmero Chasis)"}),r.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm",placeholder:"1HGCM82633...",value:d.vin||"",onChange:f=>u({...d,vin:f.target.value})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Placa / MatrÃ­cula"}),r.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm",placeholder:"C-123456",value:d.plate||"",onChange:f=>u({...d,plate:f.target.value})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Kilometraje Inicial"}),r.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2 text-sm",value:d.mileage||"",onChange:f=>u({...d,mileage:f.target.value})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"AÃ±o"}),r.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2 text-sm",value:d.year||"",onChange:f=>u({...d,year:f.target.value})})]})]});case"serialized":return r.jsxs("div",{className:"grid grid-cols-1 gap-4 border-t border-gray-100 pt-4 mt-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-purple-600 mb-2",children:[r.jsx(gt,{size:18}),r.jsx("span",{className:"font-semibold text-sm",children:"Control Serializado"})]}),r.jsxs("div",{className:"bg-purple-50 p-3 rounded text-xs text-purple-700",children:[r.jsx(vt,{size:14,className:"inline mr-1"}),"Este producto requerirÃ¡ escanear o ingresar un nÃºmero de serie Ãºnico para cada unidad que entre al inventario."]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"require_qc",checked:d.require_qc||!1,onChange:f=>u({...d,require_qc:f.target.checked})}),r.jsx("label",{htmlFor:"require_qc",className:"text-sm text-gray-700",children:"Requerir Control de Calidad al ingreso"})]})]});case"kit":return r.jsxs("div",{className:"grid grid-cols-1 gap-4 border-t border-gray-100 pt-4 mt-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-2",children:[r.jsx(de,{size:18}),r.jsx("span",{className:"font-semibold text-sm",children:"DefiniciÃ³n de Kit"})]}),r.jsxs("div",{className:"bg-blue-50 p-3 rounded text-xs text-blue-700",children:[r.jsx(vt,{size:14,className:"inline mr-1"}),'Los componentes del kit se definirÃ¡n en la pestaÃ±a "ComposiciÃ³n" despuÃ©s de crear el producto.']})]});default:return null}};return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-in fade-in duration-200",children:r.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:r.jsxs("form",{onSubmit:g,children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-900",children:t!=null&&t.id?"Editar Producto":"Nuevo Producto"}),r.jsx("button",{type:"button",onClick:e,className:"text-gray-400 hover:text-gray-600",children:r.jsx(ce,{size:24})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[r.jsxs("div",{className:"col-span-1",children:[r.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-2",children:"Tipo de Producto"}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:["simple","asset","serialized","kit"].map(f=>r.jsx("button",{type:"button",onClick:()=>a({...s,type:f}),className:`px-3 py-2 rounded text-sm font-medium border text-left capitalize transition-all ${s.type===f?"border-blue-500 bg-blue-50 text-blue-700 ring-1 ring-blue-500":"border-gray-200 text-gray-600 hover:border-gray-300"}`,children:f},f))})]}),r.jsxs("div",{className:"col-span-1 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"SKU (CÃ³digo Ãšnico)"}),r.jsx("input",{required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono",placeholder:"FIL-ACE-001",value:s.sku||"",onChange:f=>a({...s,sku:f.target.value.toUpperCase()})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Nombre del Producto"}),r.jsx("input",{required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Filtro de Aceite GenÃ©rico",value:s.name||"",onChange:f=>a({...s,name:f.target.value})})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"DescripciÃ³n"}),r.jsx("textarea",{rows:2,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",value:s.description||"",onChange:f=>a({...s,description:f.target.value})})]}),h(),r.jsxs("div",{className:"flex items-center gap-6 pt-4 border-t border-gray-100",children:[r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",className:"rounded text-blue-600 focus:ring-blue-500",checked:s.is_active,onChange:f=>a({...s,is_active:f.target.checked})}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Activo"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",className:"rounded text-blue-600 focus:ring-blue-500",checked:s.is_internal_use_only,onChange:f=>a({...s,is_internal_use_only:f.target.checked})}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Uso Interno Exclusivo"})]})]})]}),r.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-100 bg-gray-50 rounded-b-xl",children:[r.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancelar"}),r.jsx("button",{type:"submit",disabled:i,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium shadow-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Guardando...":r.jsxs(r.Fragment,{children:[r.jsx(ye,{size:18}),"Guardar Producto"]})})]})]})})})},Jn=({parentItem:e,onClose:n})=>{const[t,o]=v.useState([]),[i,s]=v.useState(""),[a,d]=v.useState([]),[u,g]=v.useState(!1);v.useEffect(()=>{(async()=>{const p=await y.data.query(`SELECT k.child_item_id, k.quantity, i.sku as child_sku, i.name as child_name
                  FROM com_hubbi_inventory_kits k
                  JOIN com_hubbi_inventory_items i ON k.child_item_id = i.id
                  WHERE k.parent_item_id = ?`,[e.id]);p&&Array.isArray(p)&&o(p)})()},[e.id]),v.useEffect(()=>{if(!i){d([]);return}const l=setTimeout(async()=>{const{data:p}=await y.data.list({table:"com_hubbi_inventory_items",query:{filter:i}});if(p){const m=p.filter(b=>b.id!==e.id&&b.type!=="kit"&&(b.name.toLowerCase().includes(i.toLowerCase())||b.sku.toLowerCase().includes(i.toLowerCase())));d(m.slice(0,5))}},300);return()=>clearTimeout(l)},[i,e.id]);const h=async l=>{const p={child_item_id:l.id,child_sku:l.sku,child_name:l.name,quantity:1};o([...t,p]),s(""),d([]),await y.data.create({table:"com_hubbi_inventory_kits",data:{parent_item_id:e.id,child_item_id:l.id,quantity:1},options:{strategy:"online_first"}})},f=async(l,p)=>{p<=0||(o(t.map(m=>m.child_item_id===l?{...m,quantity:p}:m)),await y.data.execute("UPDATE com_hubbi_inventory_kits SET quantity = ? WHERE parent_item_id = ? AND child_item_id = ?",[p,e.id,l]))},c=async l=>{o(t.filter(p=>p.child_item_id!==l)),await y.data.execute("DELETE FROM com_hubbi_inventory_kits WHERE parent_item_id = ? AND child_item_id = ?",[e.id,l])};return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg h-[80vh] flex flex-col",children:[r.jsxs("div",{className:"p-6 border-b border-gray-100",children:[r.jsxs("div",{className:"flex items-center gap-3 text-blue-600 mb-1",children:[r.jsx(de,{size:24}),r.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Configurar Kit"})]}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Definiendo contenido para: ",r.jsx("span",{className:"font-semibold text-gray-800",children:e.name})]})]}),r.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase block mb-2",children:"Agregar Componente"}),r.jsxs("div",{className:"relative",children:[r.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),r.jsx("input",{className:"w-full pl-9 pr-4 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Buscar Ã­tem...",value:i,onChange:l=>s(l.target.value)}),a.length>0&&r.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden z-20",children:a.map(l=>r.jsxs("button",{onClick:()=>h(l),className:"w-full text-left px-4 py-3 hover:bg-blue-50 border-b border-gray-50 last:border-0 flex items-center justify-between group",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-800 text-sm",children:l.name}),r.jsx("div",{className:"text-xs text-gray-400 font-mono",children:l.sku})]}),r.jsx(Re,{size:16,className:"text-blue-500 opacity-0 group-hover:opacity-100"})]},l.id))})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.length===0?r.jsxs("div",{className:"text-center py-12 text-gray-400",children:[r.jsx(de,{size:48,className:"mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"Este kit estÃ¡ vacÃ­o."}),r.jsx("p",{className:"text-xs",children:"Agrega productos usando el buscador superior."})]}):t.map(l=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg shadow-sm",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-sm text-gray-900",children:l.child_name}),r.jsx("div",{className:"text-xs text-gray-500 font-mono",children:l.child_sku})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex items-center border rounded-md",children:[r.jsx("input",{type:"number",className:"w-16 text-center text-sm py-1 border-none focus:ring-0",value:l.quantity,onChange:p=>f(l.child_item_id,parseInt(p.target.value)||0),min:"1"}),r.jsx("span",{className:"text-xs text-gray-400 pr-2",children:"unds"})]}),r.jsx("button",{onClick:()=>c(l.child_item_id),className:"text-gray-400 hover:text-red-500 p-1",children:r.jsx(xt,{size:16})})]})]},l.child_item_id))}),r.jsx("div",{className:"p-4 border-t border-gray-100 flex justify-end",children:r.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 transition-colors",children:"Terminar"})})]})})},oe=Ne(),Rn=({item:e})=>{const[n,t]=v.useState([]),[o,i]=v.useState(!0),[s,a]=v.useState([]),[d,u]=v.useState(""),g=v.useCallback(async()=>{i(!0);let l="SELECT * FROM com_hubbi_inventory_movements ORDER BY created_at DESC LIMIT 500",p=[];e&&(l="SELECT * FROM com_hubbi_inventory_movements WHERE item_id = ? ORDER BY created_at DESC LIMIT 500",p=[e.id]);const m=await y.data.query(l,p);m&&Array.isArray(m)&&t(m),i(!1)},[e]);v.useEffect(()=>{g();const l=()=>g();return y.events.on("inventory:stock:increased",l),y.events.on("inventory:stock:decreased",l),()=>{y.events.off("inventory:stock:increased",l),y.events.off("inventory:stock:increased",l),y.events.off("inventory:stock:decreased",l)}},[e,g]);const h=l=>{switch(l){case"IN":return r.jsx(Mn,{className:"text-green-600",size:16});case"OUT":return r.jsx(Dn,{className:"text-red-600",size:16});case"ADJUST":return r.jsx(On,{className:"text-gray-600",size:16});default:return r.jsx(Tn,{className:"text-blue-600",size:16})}},f=v.useMemo(()=>[oe.accessor("type",{header:({column:l})=>r.jsxs("button",{onClick:()=>l.toggleSorting(),className:"flex items-center gap-1",children:["Tipo ",r.jsx(Z,{size:14})]}),cell:l=>r.jsxs("div",{className:"flex items-center gap-2",children:[h(l.getValue()),r.jsx("span",{className:"font-medium",children:l.getValue()})]})}),oe.accessor("created_at",{header:({column:l})=>r.jsxs("button",{onClick:()=>l.toggleSorting(),className:"flex items-center gap-1",children:["Fecha ",r.jsx(Z,{size:14})]}),cell:l=>new Date(l.getValue()).toLocaleString()}),oe.accessor("reason",{header:"Motivo",cell:l=>r.jsx("div",{className:"max-w-xs truncate",title:l.getValue()||"",children:l.getValue()||"-"})}),oe.accessor("quantity",{header:({column:l})=>r.jsxs("button",{onClick:()=>l.toggleSorting(),className:"flex items-center gap-1 ml-auto",children:["Cantidad ",r.jsx(Z,{size:14})]}),cell:l=>{const m=l.row.original.type==="OUT";return r.jsxs("span",{className:`font-mono font-medium ${m?"text-red-600":"text-green-600"}`,children:[m?"-":"+",l.getValue()]})}}),oe.accessor("cost_at_moment",{header:"Costo Unit.",cell:l=>r.jsxs("span",{className:"font-mono",children:["$",l.getValue().toFixed(2)]})}),oe.accessor("total_value",{header:({column:l})=>r.jsxs("button",{onClick:()=>l.toggleSorting(),className:"flex items-center gap-1 ml-auto",children:["Total ",r.jsx(Z,{size:14})]}),cell:l=>r.jsxs("span",{className:"font-mono font-medium",children:["$",l.getValue().toFixed(2)]})})],[]),c=Be({data:n,columns:f,state:{sorting:s,globalFilter:d},onSortingChange:a,onGlobalFilterChange:u,getCoreRowModel:Ue(),getSortedRowModel:je(),getFilteredRowModel:Ge(),getPaginationRowModel:ut(),initialState:{pagination:{pageSize:20}}});return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[r.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(mt,{size:16}),"Historial de Movimientos"]}),r.jsx("input",{type:"text",placeholder:"Buscar...",value:d,onChange:l=>u(l.target.value),className:"px-3 py-1.5 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full text-left text-sm",children:[r.jsx("thead",{className:"bg-gray-50 text-gray-500",children:c.getHeaderGroups().map(l=>r.jsx("tr",{children:l.headers.map(p=>r.jsx("th",{className:"px-4 py-2 font-medium",children:ee(p.column.columnDef.header,p.getContext())},p.id))},l.id))}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:o?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-400",children:"Cargando..."})}):c.getRowModel().rows.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-400",children:"No hay movimientos registrados"})}):c.getRowModel().rows.map(l=>r.jsx("tr",{className:"hover:bg-gray-50",children:l.getVisibleCells().map(p=>r.jsx("td",{className:"px-4 py-3",children:ee(p.column.columnDef.cell,p.getContext())},p.id))},l.id))})]})}),r.jsxs("div",{className:"p-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-600",children:[r.jsxs("span",{children:["Mostrando ",c.getState().pagination.pageIndex*c.getState().pagination.pageSize+1," - ",Math.min((c.getState().pagination.pageIndex+1)*c.getState().pagination.pageSize,n.length)," de ",n.length]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>c.previousPage(),disabled:!c.getCanPreviousPage(),className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50",children:r.jsx(Pn,{size:18})}),r.jsxs("span",{children:["PÃ¡gina ",c.getState().pagination.pageIndex+1," de ",c.getPageCount()]}),r.jsx("button",{onClick:()=>c.nextPage(),disabled:!c.getCanNextPage(),className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50",children:r.jsx($n,{size:18})})]})]})]})},Yn=()=>{const[e,n]=v.useState([]),t=async()=>{const s=await y.data.query("SELECT * FROM com_hubbi_inventory_transfer_requests ORDER BY created_at DESC");if(s&&Array.isArray(s)){const a=s.map(d=>({...d,items:typeof d.items=="string"?JSON.parse(d.items):d.items}));n(a)}};v.useEffect(()=>{t()},[]);const o=async(s,a)=>{await y.data.update({table:"com_hubbi_inventory_transfer_requests",id:s,data:{status:a,updated_at:new Date().toISOString()},options:{strategy:"online_first"}}),y.notify.success(`Solicitud ${a}`),t()},i=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"in_transit":return"bg-purple-100 text-purple-800";case"received":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm h-full flex flex-col",children:[r.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Gn,{size:18,className:"text-blue-600"}),"GestiÃ³n de Traslados"]}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full text-gray-500",children:r.jsx(mt,{size:16})})]}),r.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:e.length===0?r.jsx("div",{className:"text-center py-10 text-gray-400",children:"No hay solicitudes de traslado activas"}):e.map(s=>r.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 flex flex-col gap-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsxs("span",{className:"font-medium text-gray-900",children:["#",s.source_location_id.substring(0,4),"..."]}),r.jsx(An,{size:14}),r.jsxs("span",{className:"font-medium text-gray-900",children:["#",s.target_location_id.substring(0,4),"..."]})]}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium uppercase ${i(s.status)}`,children:s.status.replace("_"," ")})]}),r.jsx("div",{className:"bg-gray-50 p-3 rounded text-sm text-gray-600 space-y-1",children:s.items.map((a,d)=>r.jsxs("div",{className:"flex justify-between",children:[r.jsxs("span",{children:["Item ID: ",a.item_id.substring(0,8),"..."]}),r.jsxs("span",{className:"font-mono font-medium",children:["x",a.quantity]})]},d))}),s.status==="pending"&&r.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100",children:[r.jsxs("button",{onClick:()=>o(s.id,"rejected"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-red-600 hover:bg-red-50 rounded bg-white border border-red-200",children:[r.jsx(ce,{size:14})," Rechazar"]}),r.jsxs("button",{onClick:()=>o(s.id,"approved"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-green-600 hover:bg-green-50 rounded bg-white border border-green-200",children:[r.jsx(te,{size:14})," Aprobar"]})]}),s.status==="approved"&&r.jsx("div",{className:"flex justify-end gap-2 pt-2",children:r.jsxs("button",{onClick:()=>o(s.id,"in_transit"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-purple-600 hover:bg-purple-50 rounded bg-white border border-purple-200",children:[r.jsx(ve,{size:14})," Despachar (Enviar)"]})})]},s.id))})]})},Xn=({data:e,companyName:n="MI EMPRESA S.A. DE C.V."})=>r.jsxs("div",{className:"bg-white p-8 max-w-2xl mx-auto border border-gray-200 shadow-sm print:shadow-none print:border-0",id:"printable-remission",children:[r.jsxs("div",{className:"flex justify-between items-start border-b border-gray-800 pb-4 mb-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900 uppercase tracking-widest",children:n}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Giro: Venta de Repuestos y Servicios"}),r.jsx("p",{className:"text-xs text-gray-500",children:"San Salvador, El Salvador"})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 border-2 border-gray-900 px-3 py-1 rounded",children:[r.jsx(ve,{size:20,className:"text-gray-900"}),r.jsx("span",{className:"font-bold text-lg",children:"NOTA DE REMISIÃ“N"})]}),r.jsxs("p",{className:"text-sm font-mono mt-2 text-gray-600",children:["REF: ",e.id.substring(0,8).toUpperCase()]}),r.jsx("p",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleDateString()})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8 text-sm",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-gray-900 mb-1 border-b border-gray-300 inline-block",children:"ORIGEN (BODEGA)"}),r.jsx("p",{className:"font-mono text-gray-600 mt-1",children:e.source_location_id})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-gray-900 mb-1 border-b border-gray-300 inline-block",children:"DESTINO (SUCURSAL)"}),r.jsx("p",{className:"font-mono text-gray-600 mt-1",children:e.target_location_id})]})]}),r.jsxs("table",{className:"w-full text-left text-sm mb-8",children:[r.jsx("thead",{className:"border-b-2 border-gray-800",children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-2 font-bold text-gray-900",children:"CODIGO"}),r.jsx("th",{className:"py-2 font-bold text-gray-900",children:"DESCRIPCION"}),r.jsx("th",{className:"py-2 font-bold text-gray-900 text-right",children:"CANTIDAD"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:e.items.map((t,o)=>r.jsxs("tr",{children:[r.jsx("td",{className:"py-2 text-gray-600 font-mono",children:t.sku||t.item_id.substring(0,6)}),r.jsx("td",{className:"py-2 text-gray-900",children:t.item_name||"Item "+t.item_id}),r.jsx("td",{className:"py-2 text-gray-900 text-right font-medium",children:t.quantity})]},o))})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-8 mt-12 pt-8 border-t border-gray-200",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"h-16 border-b border-gray-300 mb-2"}),r.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase",children:"Solicitado Por"}),r.jsx("p",{className:"text-xs text-gray-400",children:e.requested_by})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"h-16 border-b border-gray-300 mb-2"}),r.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase",children:"Despachado Por"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"h-16 border-b border-gray-300 mb-2"}),r.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase",children:"Recibido Por (Sello)"})]})]}),r.jsx("div",{className:"mt-8 text-center text-[10px] text-gray-400",children:"Documento interno de traslado. No vÃ¡lido como comprobante fiscal de venta. Generado por Hubbi Inventory Module."})]}),Zn=()=>{var g;const e=v.useRef(null),n=v.useRef(null),[t,o]=v.useState([]),[i,s]=v.useState(1),[a,d]=v.useState(null);v.useEffect(()=>{o([{id:"1",x:50,y:50,w:100,h:200,color:"#e0e7ff",label:"Estante A"},{id:"2",x:200,y:50,w:100,h:200,color:"#e0e7ff",label:"Estante B"},{id:"3",x:50,y:300,w:250,h:100,color:"#fee2e2",label:"Zona de Carga"}])},[]),v.useEffect(()=>{const h=e.current;if(!h)return;const f=h.getContext("2d");if(f){f.clearRect(0,0,h.width,h.height),f.save(),f.scale(i,i),f.strokeStyle="#f0f0f0",f.lineWidth=1;for(let c=0;c<h.width/i;c+=20)f.beginPath(),f.moveTo(c,0),f.lineTo(c,h.height/i),f.stroke();for(let c=0;c<h.height/i;c+=20)f.beginPath(),f.moveTo(0,c),f.lineTo(h.width/i,c),f.stroke();t.forEach(c=>{f.fillStyle=c.color,f.fillRect(c.x,c.y,c.w,c.h),f.strokeStyle=a===c.id?"#2563eb":"#94a3b8",f.lineWidth=a===c.id?2:1,f.strokeRect(c.x,c.y,c.w,c.h),f.fillStyle="#1e293b",f.font="12px sans-serif",f.textAlign="center",f.fillText(c.label,c.x+c.w/2,c.y+c.h/2)}),f.restore()}},[t,i,a]);const u=h=>{const f=e.current;if(!f)return;const c=f.getBoundingClientRect(),l=(h.clientX-c.left)/i,p=(h.clientY-c.top)/i,m=t.find(b=>l>=b.x&&l<=b.x+b.w&&p>=b.y&&p<=b.y+b.h);d(m?m.id:null)};return r.jsxs("div",{className:"flex h-full bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsxs("div",{className:"w-64 border-r border-gray-200 p-4 bg-gray-50 flex flex-col gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-800 font-bold border-b border-gray-200 pb-2",children:[r.jsx(Ke,{size:20,className:"text-blue-600"}),r.jsx("h2",{children:"DiseÃ±ador de Bodega"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Herramientas"}),r.jsxs("button",{className:"w-full flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded text-sm hover:bg-blue-50 hover:border-blue-200 hover:text-blue-700 transition-colors",children:[r.jsx(Ke,{size:16})," Nuevo Estante"]}),r.jsxs("button",{className:"w-full flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded text-sm hover:bg-blue-50 hover:border-blue-200 hover:text-blue-700 transition-colors",children:[r.jsx(Vn,{size:16})," Zona de Piso"]})]}),a&&r.jsxs("div",{className:"mt-auto bg-white p-3 rounded border border-gray-200 shadow-sm animate-in slide-in-from-bottom-5",children:[r.jsx("h4",{className:"text-xs font-bold text-gray-400 mb-2 uppercase",children:"Propiedades"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs text-gray-500",children:"Etiqueta"}),r.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:(g=t.find(h=>h.id===a))==null?void 0:g.label,onChange:h=>o(t.map(f=>f.id===a?{...f,label:h.target.value}:f))})]})]})]}),r.jsxs("div",{className:"flex-1 relative bg-gray-100 overflow-hidden",ref:n,children:[r.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 bg-white shadow-md rounded-lg p-1 z-10",children:[r.jsx("button",{onClick:()=>s(h=>Math.max(.5,h-.1)),className:"p-2 hover:bg-gray-100 rounded",children:r.jsx(Bn,{size:18,className:"text-gray-600"})}),r.jsxs("span",{className:"flex items-center text-xs font-mono text-gray-500 px-2 min-w-[3rem] justify-center",children:[Math.round(i*100),"%"]}),r.jsx("button",{onClick:()=>s(h=>Math.min(2,h+.1)),className:"p-2 hover:bg-gray-100 rounded",children:r.jsx(jn,{size:18,className:"text-gray-600"})}),r.jsx("div",{className:"w-px bg-gray-200 my-1 mx-1"}),r.jsx("button",{className:"p-2 hover:bg-blue-50 text-blue-600 rounded",children:r.jsx(ye,{size:18})})]}),r.jsx("div",{className:"overflow-auto w-full h-full flex justify-center items-center p-8",children:r.jsx("canvas",{ref:e,width:800,height:600,className:"bg-white shadow-xl cursor-crosshair",onMouseDown:u})})]})]})},Qn=()=>{const[e,n]=v.useState(!1),[t,o]=v.useState(null),i=s=>{n(!1),setTimeout(()=>{o({name:"Filtro Aceite Toyota",sku:s,stock:15,location:"Estante A-02"})},500)};return r.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[r.jsx("div",{className:"bg-blue-600 text-white p-4 pt-8 shadow-lg sticky top-0 z-20",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h1",{className:"text-lg font-bold",children:"Scanner Hubbi"}),r.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:r.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})})]})}),r.jsxs("div",{className:"flex-1 p-4 flex flex-col gap-6",children:[e?r.jsxs("div",{className:"bg-gray-900 rounded-2xl aspect-[4/3] flex items-center justify-center relative overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 border-2 border-red-500/50 animate-pulse"}),r.jsx("p",{className:"text-white/50 text-sm",children:"CÃ¡mara activa (Simulada)"}),r.jsxs("div",{className:"absolute bottom-4 flex gap-4",children:[r.jsx("button",{onClick:()=>i("SKU-123"),className:"bg-white text-black text-xs px-3 py-1 rounded",children:"Simular CÃ³digo 1"}),r.jsx("button",{onClick:()=>n(!1),className:"bg-white/20 text-white text-xs px-3 py-1 rounded",children:"Cancelar"})]})]}):r.jsxs("button",{onClick:()=>n(!0),className:"w-full aspect-square max-w-[200px] mx-auto bg-white rounded-3xl shadow-sm border-2 border-blue-100 flex flex-col items-center justify-center gap-4 hover:shadow-md transition-all active:scale-95",children:[r.jsx("div",{className:"bg-blue-600 p-4 rounded-full shadow-lg shadow-blue-600/30",children:r.jsx(Un,{size:32,className:"text-white"})}),r.jsx("span",{className:"font-bold text-gray-600",children:"Escanear"})]}),t&&r.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 animate-in slide-in-from-bottom-10 fade-in",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-xl text-gray-900",children:t.name}),r.jsx("p",{className:"text-gray-400 font-mono text-sm",children:t.sku})]}),r.jsx("div",{className:"bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold",children:"Activo"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[r.jsx("span",{className:"text-xs text-gray-500 uppercase block mb-1",children:"Stock"}),r.jsx("span",{className:"text-2xl font-bold text-gray-900",children:t.stock})]}),r.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[r.jsx("span",{className:"text-xs text-gray-500 uppercase block mb-1",children:"UbicaciÃ³n"}),r.jsx("span",{className:"text-lg font-semibold text-blue-600",children:t.location})]})]}),r.jsxs("div",{className:"mt-6 flex gap-3",children:[r.jsx("button",{className:"flex-1 bg-blue-600 text-white py-3 rounded-xl font-medium shadow-lg shadow-blue-600/20 active:bg-blue-700",children:"Ver Detalles"}),r.jsx("button",{className:"flex-1 bg-white border border-gray-200 text-gray-700 py-3 rounded-xl font-medium active:bg-gray-50",children:"Inventariar"})]})]})]})]})},xe=Ne(),eo=()=>{const[e,n]=v.useState([]),[t,o]=v.useState(null),[i,s]=v.useState(!1),[a,d]=v.useState([]),[u,g]=v.useState("");v.useEffect(()=>{(async()=>{const b=await y.data.query("SELECT * FROM com_hubbi_inventory_audits ORDER BY started_at DESC LIMIT 10");b&&Array.isArray(b)&&n(b.map(x=>({...x,lines:[]})))})()},[]);const h=async m=>{s(!0);const b=crypto.randomUUID(),x=await y.data.query(`SELECT s.item_id, s.quantity, i.name, i.sku 
             FROM com_hubbi_inventory_stock s 
             JOIN com_hubbi_inventory_items i ON s.item_id = i.id
             WHERE s.location_id = ?`,[m]);await y.data.execute("INSERT INTO com_hubbi_inventory_audits (id, location_id, status, started_at) VALUES (?, ?, 'open', ?)",[b,m,new Date().toISOString()]);for(const S of x||[])await y.data.execute("INSERT INTO com_hubbi_inventory_audit_lines (audit_id, item_id, expected_qty) VALUES (?, ?, ?)",[b,S.item_id,S.quantity]);const w={id:b,location_id:m,status:"open",started_at:new Date().toISOString(),lines:(x||[]).map(S=>({item_id:S.item_id,item_name:S.name,item_sku:S.sku,expected_qty:S.quantity,counted_qty:null,difference:null,notes:""}))};o(w),n([w,...e]),s(!1),y.notify.success("AuditorÃ­a iniciada")},f=v.useCallback((m,b,x)=>{t&&o({...t,lines:t.lines.map(w=>w.item_id===m?{...w,counted_qty:b,difference:b-w.expected_qty,notes:x||w.notes}:w)})},[t]),c=async()=>{if(t){s(!0);for(const m of t.lines)if(m.counted_qty!==null&&(await y.data.execute(`UPDATE com_hubbi_inventory_audit_lines 
                     SET counted_qty = ?, difference = ?, notes = ? 
                     WHERE audit_id = ? AND item_id = ?`,[m.counted_qty,m.difference,m.notes,t.id,m.item_id]),m.difference!==0)){const b=crypto.randomUUID();await y.data.execute(`INSERT INTO com_hubbi_inventory_movements (id, item_id, location_id, type, reason, quantity, created_by, created_at)
                         VALUES (?, ?, ?, 'ADJUST', 'Ajuste por auditorÃ­a fÃ­sica', ?, 'audit_system', ?)`,[b,m.item_id,t.location_id,Math.abs(m.difference),new Date().toISOString()]),await y.data.execute("UPDATE com_hubbi_inventory_stock SET quantity = ? WHERE item_id = ? AND location_id = ?",[m.counted_qty,m.item_id,t.location_id])}await y.data.execute("UPDATE com_hubbi_inventory_audits SET status = 'closed', closed_at = ? WHERE id = ?",[new Date().toISOString(),t.id]),y.notify.success("AuditorÃ­a finalizada. Ajustes aplicados."),o(null),s(!1)}},l=v.useMemo(()=>[xe.accessor("item_name",{header:({column:m})=>r.jsxs("button",{onClick:()=>m.toggleSorting(),className:"flex items-center gap-1",children:["Producto ",r.jsx(Z,{size:14})]}),cell:m=>r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:m.getValue()}),r.jsx("div",{className:"text-xs text-gray-400 font-mono",children:m.row.original.item_sku})]})}),xe.accessor("expected_qty",{header:({column:m})=>r.jsxs("button",{onClick:()=>m.toggleSorting(),className:"flex items-center gap-1",children:["Esperado ",r.jsx(Z,{size:14})]}),cell:m=>r.jsx("span",{className:"font-mono",children:m.getValue()})}),xe.display({id:"counted",header:"Contado",cell:({row:m})=>{const b=m.original;return r.jsx("input",{type:"number",className:"w-20 text-center border rounded-lg py-1 font-mono",value:b.counted_qty??"",onChange:x=>f(b.item_id,parseInt(x.target.value)||0),disabled:(t==null?void 0:t.status)!=="open"})}}),xe.accessor("difference",{header:"Diferencia",cell:m=>{const b=m.getValue();if(b===null)return null;const x=b===0?"bg-green-100 text-green-700":b>0?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700";return r.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold ${x}`,children:[b===0?r.jsx(te,{size:12}):r.jsx(We,{size:12}),b>0?"+":"",b]})}})],[t,f]),p=Be({data:(t==null?void 0:t.lines)||[],columns:l,state:{sorting:a,globalFilter:u},onSortingChange:d,onGlobalFilterChange:g,getCoreRowModel:Ue(),getSortedRowModel:je(),getFilteredRowModel:Ge()});return r.jsxs("div",{className:"flex h-full bg-white rounded-lg shadow-sm overflow-hidden",children:[r.jsxs("div",{className:"w-72 border-r border-gray-200 bg-gray-50 flex flex-col",children:[r.jsx("div",{className:"p-4 border-b border-gray-200",children:r.jsxs("h2",{className:"font-bold text-gray-900 flex items-center gap-2",children:[r.jsx(ht,{size:20,className:"text-blue-600"}),"AuditorÃ­as FÃ­sicas"]})}),r.jsx("div",{className:"p-4",children:r.jsx("button",{onClick:()=>h("default-location"),disabled:i,className:"w-full bg-blue-600 text-white py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50",children:"+ Nueva AuditorÃ­a"})}),r.jsx("div",{className:"flex-1 overflow-auto p-2 space-y-2",children:e.map(m=>r.jsxs("button",{onClick:()=>o(m),className:`w-full text-left p-3 rounded-lg border transition-colors ${(t==null?void 0:t.id)===m.id?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:bg-gray-50"}`,children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:new Date(m.started_at).toLocaleDateString()}),r.jsx("div",{className:"text-xs text-gray-500",children:m.status==="open"?"ðŸŸ¡ Abierta":"ðŸŸ¢ Cerrada"})]},m.id))})]}),r.jsx("div",{className:"flex-1 flex flex-col",children:t?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-gray-900",children:"Conteo en Progreso"}),r.jsxs("p",{className:"text-sm text-gray-500",children:[t.lines.length," productos"]})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),r.jsx("input",{type:"text",placeholder:"Buscar...",value:u,onChange:m=>g(m.target.value),className:"pl-9 pr-4 py-1.5 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.status==="open"&&r.jsxs("button",{onClick:c,disabled:i,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 disabled:opacity-50",children:[r.jsx(ye,{size:18})," Finalizar"]})]})]}),r.jsx("div",{className:"flex-1 overflow-auto",children:r.jsxs("table",{className:"w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 sticky top-0",children:p.getHeaderGroups().map(m=>r.jsx("tr",{children:m.headers.map(b=>r.jsx("th",{className:"text-left p-3 font-semibold text-gray-600",children:ee(b.column.columnDef.header,b.getContext())},b.id))},m.id))}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:p.getRowModel().rows.map(m=>r.jsx("tr",{className:"hover:bg-gray-50",children:m.getVisibleCells().map(b=>r.jsx("td",{className:"p-3",children:ee(b.column.columnDef.cell,b.getContext())},b.id))},m.id))})]})})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400",children:r.jsxs("div",{className:"text-center",children:[r.jsx(ht,{size:48,className:"mx-auto mb-4 opacity-30"}),r.jsx("p",{children:"Selecciona o crea una auditorÃ­a"})]})})})]})},wt=()=>{const[e,n]=v.useState([]),[t,o]=v.useState(!0),[i,s]=v.useState(null),a=v.useCallback(async()=>{o(!0);const g=await y.data.query(`
            SELECT 
                s.item_id,
                s.location_id,
                s.quantity as current_qty,
                s.min_stock,
                s.reorder_point,
                i.name as item_name,
                i.sku as item_sku,
                l.name as location_name
            FROM com_hubbi_inventory_stock s
            JOIN com_hubbi_inventory_items i ON s.item_id = i.id
            LEFT JOIN com_hubbi_inventory_locations l ON s.location_id = l.id
            WHERE s.quantity <= s.reorder_point OR s.quantity <= s.min_stock
            ORDER BY (s.min_stock - s.quantity) DESC
        `);if(g&&Array.isArray(g)){const h=g.map(f=>({...f,severity:f.current_qty<=f.min_stock?"critical":f.current_qty<=f.reorder_point?"warning":"ok"}));n(h)}s(new Date),o(!1)},[]);v.useEffect(()=>{a();const g=()=>{a()};return y.events.on("inventory:stock:increased",g),y.events.on("inventory:stock:decreased",g),()=>{y.events.off("inventory:stock:increased",g),y.events.off("inventory:stock:decreased",g)}},[a]);const d=e.filter(g=>g.severity==="critical").length,u=e.filter(g=>g.severity==="warning").length;return{alerts:e,criticalCount:d,warningCount:u,loading:t,lastCheck:i,refresh:a}},Ct=({compact:e=!1})=>{const{alerts:n,criticalCount:t,warningCount:o,loading:i,lastCheck:s,refresh:a}=wt(),d=e?n.slice(0,3):n;return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[r.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(pt,{size:20,className:"text-orange-500"}),r.jsx("h3",{className:"font-semibold text-gray-900",children:"Alertas de Stock"}),t>0&&r.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold",children:t}),o>0&&r.jsx("span",{className:"bg-yellow-500 text-white text-xs px-2 py-0.5 rounded-full font-bold",children:o})]}),r.jsx("button",{onClick:a,disabled:i,className:"p-2 hover:bg-gray-100 rounded-full text-gray-500 disabled:opacity-50",children:r.jsx(zn,{size:16,className:i?"animate-spin":""})})]}),r.jsx("div",{className:`${e?"max-h-32":"max-h-64"} overflow-auto`,children:d.length===0?r.jsxs("div",{className:"p-8 text-center text-gray-400",children:[r.jsx(pt,{size:32,className:"mx-auto mb-2 opacity-30"}),r.jsx("p",{children:"No hay alertas de stock"})]}):r.jsx("div",{className:"divide-y divide-gray-100",children:d.map((u,g)=>r.jsxs("div",{className:`p-3 flex items-center gap-3 ${u.severity==="critical"?"bg-red-50":u.severity==="warning"?"bg-yellow-50":""}`,children:[r.jsx(We,{size:18,className:u.severity==="critical"?"text-red-500":"text-yellow-500"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-gray-900 truncate",children:u.item_name}),r.jsxs("div",{className:"text-xs text-gray-500",children:[u.location_name||"Sin ubicaciÃ³n"," â€¢ Stock: ",u.current_qty," / MÃ­nimo: ",u.min_stock]})]}),r.jsx("div",{className:`text-xs font-bold px-2 py-1 rounded ${u.severity==="critical"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:u.severity==="critical"?"CRÃTICO":"BAJO"})]},g))})}),s&&r.jsxs("div",{className:"p-2 border-t border-gray-100 text-xs text-gray-400 text-center",children:["Ãšltima verificaciÃ³n: ",s.toLocaleTimeString()]})]})},$="com.hubbi.inventory",to="com.hubbi.accounting";function ue(){const[e,n]=v.useState([]),[t,o]=v.useState(null),[i,s]=v.useState(null),[a,d]=v.useState(!0),[u,g]=v.useState(null);v.useEffect(()=>{h()},[]);const h=async()=>{var C;d(!0),await f();const S=await y.db.query("SELECT * FROM hubbi_fiscal_config WHERE id = 'default'",[],{moduleId:$});S&&S.length>0&&s(S[0]),!await y.modules.isInstalled(to)&&((C=S[0])==null?void 0:C.managed_by)!==$&&await y.db.execute("UPDATE hubbi_fiscal_config SET managed_by = ? WHERE id = 'default'",[$],{moduleId:$}),await c(),await l(),d(!1)},f=async()=>{await y.db.execute(`
      CREATE TABLE IF NOT EXISTS hubbi_fiscal_config (
        id TEXT PRIMARY KEY DEFAULT 'default',
        lock_after_periods INTEGER DEFAULT 2,
        auto_close BOOLEAN DEFAULT FALSE,
        period_type TEXT DEFAULT 'monthly',
        fiscal_year_start_month INTEGER DEFAULT 1,
        managed_by TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )
    `,[],{moduleId:$}),await y.db.execute(`
      INSERT OR IGNORE INTO hubbi_fiscal_config (id, lock_after_periods, period_type)
      VALUES ('default', 2, 'monthly')
    `,[],{moduleId:$}),await y.db.execute(`
      CREATE TABLE IF NOT EXISTS hubbi_fiscal_periods (
        id TEXT PRIMARY KEY,
        year INTEGER NOT NULL,
        month INTEGER NOT NULL,
        quarter INTEGER,
        start_date DATE NOT NULL,
        end_date DATE NOT NULL,
        status TEXT DEFAULT 'open',
        is_current BOOLEAN DEFAULT FALSE,
        created_by_module TEXT,
        closed_by TEXT,
        closed_at DATETIME,
        locked_at DATETIME,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        UNIQUE(year, month)
      )
    `,[],{moduleId:$})},c=async()=>{const S=await y.db.query("SELECT * FROM hubbi_fiscal_periods WHERE is_current = TRUE",[],{moduleId:$});if(!S||S.length===0){const F=new Date,C=F.getFullYear(),T=F.getMonth()+1,V=`${C}-${String(T).padStart(2,"0")}`,L=new Date(C,T-1,1).toISOString().split("T")[0],M=new Date(C,T,0).toISOString().split("T")[0];await y.db.execute(`
        INSERT OR IGNORE INTO hubbi_fiscal_periods 
          (id, year, month, start_date, end_date, status, is_current, created_by_module)
        VALUES (?, ?, ?, ?, ?, 'open', TRUE, ?)
      `,[V,C,T,L,M,$],{moduleId:$})}},l=async()=>{const S=await y.db.query("SELECT * FROM hubbi_fiscal_periods ORDER BY year DESC, month DESC",[],{moduleId:$});if(S){n(S);const F=S.find(C=>C.is_current);o(F||null),!u&&F&&g(F.id)}},p=v.useCallback(S=>{if(!i||!t)return!1;const F=e.find(L=>L.id===S);if(!F||F.status==="closed"||F.status==="locked")return!1;const C=t.year*12+t.month,T=F.year*12+F.month;return C-T<=i.lock_after_periods},[i,t,e]);return{periods:e,currentPeriod:t,config:i,loading:a,selectedPeriodId:u,selectPeriod:S=>{g(S)},getSelectedPeriod:()=>e.find(S=>S.id===u)||t,isPeriodEditable:p,closePeriod:async(S,F)=>{const C=e.find(T=>T.id===S);if(!C||C.status!=="open")return!1;if(await y.db.execute(`UPDATE hubbi_fiscal_periods 
       SET status = 'closed', closed_by = ?, closed_at = ? 
       WHERE id = ?`,[F,new Date().toISOString(),S],{moduleId:$}),C.is_current){const T=C.month===12?1:C.month+1,V=C.month===12?C.year+1:C.year,L=`${V}-${String(T).padStart(2,"0")}`,M=new Date(V,T-1,1).toISOString().split("T")[0],P=new Date(V,T,0).toISOString().split("T")[0];await y.db.execute("UPDATE hubbi_fiscal_periods SET is_current = FALSE WHERE id = ?",[S],{moduleId:$}),await y.db.execute(`
        INSERT OR IGNORE INTO hubbi_fiscal_periods 
          (id, year, month, start_date, end_date, status, is_current, created_by_module)
        VALUES (?, ?, ?, ?, ?, 'open', TRUE, ?)
      `,[L,V,T,M,P,$],{moduleId:$})}return await l(),!0},updateConfig:async S=>{const F=[],C=[];S.lock_after_periods!==void 0&&(F.push("lock_after_periods = ?"),C.push(S.lock_after_periods)),S.auto_close!==void 0&&(F.push("auto_close = ?"),C.push(S.auto_close)),S.period_type!==void 0&&(F.push("period_type = ?"),C.push(S.period_type)),F.length>0&&(F.push("updated_at = ?"),C.push(new Date().toISOString()),C.push("default"),await y.db.execute(`UPDATE hubbi_fiscal_config SET ${F.join(", ")} WHERE id = ?`,C,{moduleId:$}),await h())},refreshPeriods:l}}async function _e(){const e=await y.db.query("SELECT * FROM hubbi_fiscal_periods WHERE is_current = TRUE",[],{moduleId:$});return e&&e.length>0?e[0]:null}async function Nt(e){const n=await y.db.query("SELECT * FROM hubbi_fiscal_periods WHERE id = ?",[e],{moduleId:$});return n&&n.length>0?n[0]:null}async function Ye(e){const[n,t,o]=await Promise.all([Nt(e),_e(),y.db.query("SELECT * FROM hubbi_fiscal_config WHERE id = 'default'",[],{moduleId:$})]);if(!n||!t||!o||o.length===0)return!1;const i=o[0];if(n.status==="closed"||n.status==="locked")return!1;const s=t.year*12+t.month,a=n.year*12+n.month;return s-a<=i.lock_after_periods}const Et=["","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],no=({onChange:e,className:n=""})=>{const{periods:t,currentPeriod:o,selectedPeriodId:i,selectPeriod:s,isPeriodEditable:a,loading:d}=ue(),u=c=>{s(c),e==null||e(c)},g=c=>`${Et[c.month]} ${c.year}`,h=c=>c.is_current?r.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:"Actual"}):c.status==="closed"?r.jsx("span",{className:"ml-2 text-xs bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded",children:"Cerrado"}):c.status==="locked"?r.jsx("span",{className:"ml-2 text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded",children:"Bloqueado"}):null,f=t.find(c=>c.id===i)||o;return d?r.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm ${n}`,children:[r.jsx(Je,{size:16,className:"text-gray-400"}),r.jsx("span",{className:"text-gray-400",children:"Cargando..."})]}):r.jsx("div",{className:`relative inline-block ${n}`,children:r.jsxs("details",{className:"group",children:[r.jsxs("summary",{className:"list-none cursor-pointer inline-flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[r.jsx(Je,{size:16,className:"text-blue-600"}),r.jsx("span",{className:"font-medium text-gray-900",children:f?g(f):"Seleccionar perÃ­odo"}),f&&!a(f.id)&&r.jsx("span",{title:"Solo lectura",children:r.jsx(me,{size:14,className:"text-amber-500"})}),r.jsx(ft,{size:16,className:"text-gray-400 group-open:rotate-180 transition-transform"})]}),r.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-xl z-50 max-h-80 overflow-auto",children:[t.map(c=>{const l=c.id===i,p=a(c.id);return r.jsxs("button",{onClick:()=>u(c.id),className:`w-full text-left px-4 py-3 flex items-center justify-between hover:bg-gray-50 border-b border-gray-50 last:border-0 ${l?"bg-blue-50":""}`,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[l&&r.jsx(te,{size:16,className:"text-blue-600"}),r.jsx("span",{className:`${l?"font-semibold text-blue-900":"text-gray-700"}`,children:g(c)}),h(c)]}),!p&&r.jsx(me,{size:14,className:"text-gray-400"})]},c.id)}),t.length===0&&r.jsx("div",{className:"px-4 py-6 text-center text-gray-400 text-sm",children:"No hay perÃ­odos disponibles"})]})]})})},oo=({className:e=""})=>{const{currentPeriod:n,loading:t}=ue();return t||!n?null:r.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium ${e}`,children:[r.jsx(Je,{size:12}),Et[n.month]," ",n.year]})};function re(){const[e,n]=v.useState({assignedSubHubId:null,activeSubHubId:null,subHubs:[],canViewAll:!1,canEditOwn:!0,canEditAll:!1,canSwitchActive:!1}),[t,o]=v.useState(!0);v.useEffect(()=>{i()},[]);const i=async()=>{o(!0);const h=y.getContext(),f=(h==null?void 0:h.subHubId)||null,c=y.permissions.has("inventory:view_all_subhubs"),l=y.permissions.has("inventory:edit_own_subhub"),p=y.permissions.has("inventory:edit_all_subhubs"),m=y.permissions.has("inventory:switch_active_subhub");let b=[];try{b=await y.subHubs.list()||[]}catch{b=[]}let x=f;if(m){const w=await y.settings.get("active_subhub_id");w&&b.some(S=>S.id===w)&&(x=w)}n({assignedSubHubId:f,activeSubHubId:x,subHubs:b,canViewAll:c,canEditOwn:l,canEditAll:p,canSwitchActive:m}),o(!1)},s=v.useCallback(async h=>e.canSwitchActive?(await y.settings.set("active_subhub_id",h),n(f=>({...f,activeSubHubId:h})),y.notify("Sucursal activa cambiada","success"),!0):(y.notify("No tienes permiso para cambiar de sucursal","error"),!1),[e.canSwitchActive]),a=v.useCallback(h=>!!(e.canEditAll||e.canEditOwn&&h===e.assignedSubHubId),[e.canEditAll,e.canEditOwn,e.assignedSubHubId]),d=v.useCallback((h="sub_hub_id")=>e.canViewAll?e.activeSubHubId?` AND ${h} = '${e.activeSubHubId}'`:"":e.assignedSubHubId?` AND ${h} = '${e.assignedSubHubId}'`:" AND 1=0",[e.canViewAll,e.activeSubHubId,e.assignedSubHubId]),u=v.useCallback(()=>e.canSwitchActive&&e.activeSubHubId?e.activeSubHubId:e.assignedSubHubId,[e.canSwitchActive,e.activeSubHubId,e.assignedSubHubId]),g=v.useCallback(()=>{const h=e.activeSubHubId||e.assignedSubHubId,f=e.subHubs.find(c=>c.id===h);return(f==null?void 0:f.name)||"Sin Sucursal"},[e.activeSubHubId,e.assignedSubHubId,e.subHubs]);return{...e,loading:t,setActiveSubHub:s,canEditSubHub:a,getSubHubWhereClause:d,getEffectiveSubHubId:u,getActiveSubHubName:g,refreshContext:i}}function ro(){const e=y.getContext();return(e==null?void 0:e.subHubId)||null}async function io(e,n){const t=y.getContext(),o=(t==null?void 0:t.subHubId)||null;return n==="view"?y.permissions.has("inventory:view_all_subhubs")?!0:e===o:n==="edit"?!!(y.permissions.has("inventory:edit_all_subhubs")||y.permissions.has("inventory:edit_own_subhub")&&e===o):!1}const so=({onChange:e,className:n="",compact:t=!1})=>{const{subHubs:o,activeSubHubId:i,assignedSubHubId:s,canSwitchActive:a,canEditSubHub:d,setActiveSubHub:u,getActiveSubHubName:g,loading:h}=re(),f=async c=>{await u(c)&&(e==null||e(c))};return a?h?r.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm ${n}`,children:[r.jsx(le,{size:16,className:"text-gray-400"}),r.jsx("span",{className:"text-gray-400",children:"Cargando..."})]}):o.length===0?r.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm ${n}`,children:[r.jsx(le,{size:16,className:"text-gray-500"}),r.jsx("span",{className:"text-gray-500",children:"Sin Sucursales"})]}):r.jsx("div",{className:`relative inline-block ${n}`,children:r.jsxs("details",{className:"group",children:[r.jsxs("summary",{className:"list-none cursor-pointer inline-flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[r.jsx(le,{size:16,className:"text-indigo-600"}),r.jsx("span",{className:`font-medium text-gray-900 ${t?"hidden sm:inline":""}`,children:g()}),r.jsx(ft,{size:16,className:"text-gray-400 group-open:rotate-180 transition-transform"})]}),r.jsx("div",{className:"absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-xl z-50 max-h-80 overflow-auto",children:o.map(c=>{const l=c.id===i,p=c.id===s,m=d(c.id);return r.jsxs("button",{onClick:()=>f(c.id),className:`w-full text-left px-4 py-3 flex items-center justify-between hover:bg-gray-50 border-b border-gray-50 last:border-0 ${l?"bg-indigo-50":""}`,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[l&&r.jsx(te,{size:16,className:"text-indigo-600"}),r.jsxs("div",{children:[r.jsx("span",{className:`block ${l?"font-semibold text-indigo-900":"text-gray-700"}`,children:c.name}),p&&r.jsx("span",{className:"text-xs text-gray-400",children:"Tu sucursal asignada"})]})]}),r.jsx("div",{className:"flex items-center gap-1",children:!m&&r.jsx("span",{className:"text-xs bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded",children:"Solo lectura"})})]},c.id)})})]})}):r.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm ${n}`,children:[r.jsx(le,{size:16,className:"text-gray-500"}),r.jsx("span",{className:"text-gray-700",children:g()}),r.jsx("span",{title:"No puedes cambiar de sucursal",children:r.jsx(me,{size:14,className:"text-gray-400"})})]})},ao=({className:e=""})=>{const{getActiveSubHubName:n,loading:t,canEditSubHub:o,activeSubHubId:i}=re();if(t)return null;const s=i?o(i):!1;return r.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded text-xs font-medium ${s?"bg-indigo-50 text-indigo-700":"bg-gray-100 text-gray-600"} ${e}`,children:[r.jsx(le,{size:12}),n(),!s&&r.jsx(me,{size:10})]})},lo=[{value:"correction",label:"CorrecciÃ³n de inventario"},{value:"damage",label:"Producto daÃ±ado"},{value:"expired",label:"Producto vencido"},{value:"internal_use",label:"Uso interno"},{value:"found",label:"Producto encontrado"},{value:"other",label:"Otro"}],co=({onClose:e,onSuccess:n})=>{var J;const[t,o]=v.useState(""),[i,s]=v.useState([]),[a,d]=v.useState(null),[u,g]=v.useState([]),[h,f]=v.useState(""),[c,l]=v.useState("add"),[p,m]=v.useState(0),[b,x]=v.useState("correction"),[w,S]=v.useState(""),[F,C]=v.useState(!1),[T,V]=v.useState(!1),{currentPeriod:L,isPeriodEditable:M}=ue(),{canEditSubHub:P,getEffectiveSubHubId:H}=re(),O=v.useCallback(async()=>{if(!t.trim()){s([]);return}C(!0);const I=await y.db.query(`SELECT * FROM com_hubbi_inventory_items 
       WHERE (name LIKE ? OR sku LIKE ? OR barcode LIKE ?)
       AND is_active = TRUE
       LIMIT 10`,[`%${t}%`,`%${t}%`,`%${t}%`],{moduleId:"com.hubbi.inventory"});s(I),C(!1)},[t]),j=async I=>{d(I),s([]),o(I.name);const W=await y.db.query(`SELECT s.location_id as locationId, l.name as locationName, s.quantity as currentStock
       FROM com_hubbi_inventory_stock s
       JOIN com_hubbi_inventory_locations l ON s.location_id = l.id
       WHERE s.item_id = ?`,[I.id],{moduleId:"com.hubbi.inventory"});g(W),W.length>0&&f(W[0].locationId)},B=async()=>{var Ht,zt,Ut;if(!a||!h||p<=0){y.notify("Completa todos los campos","warning");return}if(L&&!M(L.id)){y.notify("El perÃ­odo actual estÃ¡ cerrado. No se puede ajustar.","error");return}const I=H();if(I&&!P(I)){y.notify("No tienes permiso para editar esta sucursal.","error");return}if(p>100&&!await((zt=(Ht=y.auth).requireRevalidation)==null?void 0:zt.call(Ht,"Ajuste de inventario mayor a 100 unidades"))){y.notify("RevalidaciÃ³n de identidad cancelada","warning");return}V(!0);const W=crypto.randomUUID(),D=c==="add"?p:-p,Q=c==="add"?"IN":"OUT",we=a.weighted_average_cost||0;await y.db.execute(`
      INSERT INTO com_hubbi_inventory_movements 
        (id, item_id, location_id, type, reason, quantity, cost_at_moment, total_value, created_by, period_id, sub_hub_id)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `,[W,a.id,h,Q,b+(w?`: ${w}`:""),Math.abs(D),we,Math.abs(D)*we,((Ut=y.getContext())==null?void 0:Ut.userId)||"system",(L==null?void 0:L.id)||null,I],{moduleId:"com.hubbi.inventory"}),await y.db.execute(`
      INSERT INTO com_hubbi_inventory_stock (item_id, location_id, quantity)
      VALUES (?, ?, ?)
      ON CONFLICT(item_id, location_id) DO UPDATE SET quantity = quantity + ?
    `,[a.id,h,D,D],{moduleId:"com.hubbi.inventory"}),V(!1),y.notify(`Ajuste registrado: ${c==="add"?"+":"-"}${p} ${a.name}`,"success"),n==null||n(),e()},G=((J=u.find(I=>I.locationId===h))==null?void 0:J.currentStock)||0,A=c==="add"?G+p:G-p;return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(de,{className:"text-indigo-600",size:20}),"Ajuste RÃ¡pido"]}),r.jsx("button",{onClick:e,className:"p-1 hover:bg-gray-100 rounded",children:r.jsx(ce,{size:20,className:"text-gray-500"})})]}),r.jsxs("div",{className:"p-6 space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar Producto"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:t,onChange:I=>o(I.target.value),onKeyDown:I=>I.key==="Enter"&&O(),placeholder:"CÃ³digo, SKU o nombre...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),r.jsx(be,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),r.jsx("button",{onClick:O,disabled:F,className:"absolute right-2 top-1.5 px-3 py-1 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700",children:"Buscar"})]}),i.length>0&&r.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-auto",children:i.map(I=>r.jsxs("button",{onClick:()=>j(I),className:"w-full text-left px-4 py-2 hover:bg-gray-50 border-b last:border-0",children:[r.jsx("div",{className:"font-medium",children:I.name}),r.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",I.sku]})]},I.id))})]}),a&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg",children:[r.jsx("div",{className:"font-medium text-indigo-900",children:a.name}),r.jsxs("div",{className:"text-sm text-indigo-700",children:["SKU: ",a.sku]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bodega"}),r.jsx("select",{value:h,onChange:I=>f(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:u.map(I=>r.jsxs("option",{value:I.locationId,children:[I.locationName," (Stock: ",I.currentStock,")"]},I.locationId))})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:()=>l("add"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 ${c==="add"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(Re,{size:18})," Entrada"]}),r.jsxs("button",{onClick:()=>l("subtract"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 ${c==="subtract"?"bg-red-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(qn,{size:18})," Salida"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cantidad"}),r.jsx("input",{type:"number",value:p,onChange:I=>m(Math.max(0,parseInt(I.target.value)||0)),min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RazÃ³n"}),r.jsx("select",{value:b,onChange:I=>x(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:lo.map(I=>r.jsx("option",{value:I.value,children:I.label},I.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notas (opcional)"}),r.jsx("input",{type:"text",value:w,onChange:I=>S(I.target.value),placeholder:"Detalles adicionales...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),r.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Stock resultante:"}),r.jsxs("span",{className:`font-bold ${A<0?"text-red-600":"text-gray-900"}`,children:[G," â†’ ",A]})]}),A<0&&r.jsxs("div",{className:"flex items-center gap-2 text-amber-600 text-sm",children:[r.jsx(We,{size:16}),"El stock resultante serÃ¡ negativo"]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 px-6 py-4 border-t bg-gray-50 rounded-b-xl",children:[r.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg",children:"Cancelar"}),r.jsxs("button",{onClick:B,disabled:!a||!h||p<=0||T,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2",children:[r.jsx(ye,{size:16}),T?"Guardando...":"Guardar Ajuste"]})]})]})})},uo=[{value:"initial",label:"Carga Inicial",description:"Crear productos y establecer stock inicial"},{value:"adjust",label:"Ajuste Masivo",description:"Ajustar cantidades existentes (+/-)"},{value:"sync",label:"SincronizaciÃ³n",description:"Reemplazar stock actual con valores del Excel"}],go=({onClose:e,onSuccess:n})=>{const[t,o]=v.useState(null),[i,s]=v.useState("initial"),[a,d]=v.useState(""),[u,g]=v.useState([]),[h,f]=v.useState([]),[c,l]=v.useState(!1),[p,m]=v.useState("upload"),[b,x]=v.useState({success:0,errors:0}),{currentPeriod:w,isPeriodEditable:S}=ue(),{getEffectiveSubHubId:F,canEditSubHub:C}=re();v.useState(()=>{(async()=>{const P=await y.db.query("SELECT id, name FROM com_hubbi_inventory_locations WHERE is_active = TRUE",[],{moduleId:"com.hubbi.inventory"});g(P),P.length>0&&d(P[0].id)})()});const T=v.useCallback(async M=>{var W;const P=(W=M.target.files)==null?void 0:W[0];if(!P)return;o(P);const O=(await P.text()).split(`
`),j=O[0].toLowerCase().split(",").map(D=>D.trim()),B=j.findIndex(D=>D.includes("sku")||D.includes("codigo")),G=j.findIndex(D=>D.includes("name")||D.includes("nombre")),A=j.findIndex(D=>D.includes("qty")||D.includes("quantity")||D.includes("cantidad")),J=j.findIndex(D=>D.includes("cost")||D.includes("costo")||D.includes("precio"));if(B===-1||A===-1){y.notify("El archivo debe tener columnas SKU y Cantidad","error");return}const I=[];for(let D=1;D<O.length;D++){const Q=O[D].split(",").map(we=>we.trim());Q[B]&&I.push({sku:Q[B],name:G>=0?Q[G]:void 0,quantity:parseFloat(Q[A])||0,cost:J>=0?parseFloat(Q[J]):void 0})}f(I),m("preview")},[]),V=async()=>{var j,B,G;if(w&&!S(w.id)){y.notify("El perÃ­odo actual estÃ¡ cerrado","error");return}const M=F();if(M&&!C(M)){y.notify("No tienes permiso para editar esta sucursal","error");return}if(!await((B=(j=y.auth).requireRevalidation)==null?void 0:B.call(j,"ImportaciÃ³n masiva de inventario"))){y.notify("RevalidaciÃ³n de identidad cancelada","warning");return}l(!0);let H=0,O=0;for(const A of h)try{const J=await y.db.query("SELECT id FROM com_hubbi_inventory_items WHERE sku = ?",[A.sku],{moduleId:"com.hubbi.inventory"});let I;if(J.length===0&&i==="initial"&&A.name)I=crypto.randomUUID(),await y.db.execute(`
            INSERT INTO com_hubbi_inventory_items (id, sku, name, weighted_average_cost, is_active)
            VALUES (?, ?, ?, ?, TRUE)
          `,[I,A.sku,A.name,A.cost||0],{moduleId:"com.hubbi.inventory"});else if(J.length>0)I=J[0].id;else{A.error="Producto no encontrado",O++;continue}if(i==="initial")await y.db.execute(`
            INSERT INTO com_hubbi_inventory_stock (item_id, location_id, quantity)
            VALUES (?, ?, ?)
            ON CONFLICT(item_id, location_id) DO UPDATE SET quantity = ?
          `,[I,a,A.quantity,A.quantity],{moduleId:"com.hubbi.inventory"});else if(i==="adjust"){const W=crypto.randomUUID();await y.db.execute(`
            INSERT INTO com_hubbi_inventory_movements 
              (id, item_id, location_id, type, reason, quantity, created_by, period_id)
            VALUES (?, ?, ?, 'ADJUST', 'excel_import', ?, ?, ?)
          `,[W,I,a,A.quantity,(G=y.getContext())==null?void 0:G.userId,w==null?void 0:w.id],{moduleId:"com.hubbi.inventory"}),await y.db.execute(`
            INSERT INTO com_hubbi_inventory_stock (item_id, location_id, quantity)
            VALUES (?, ?, ?)
            ON CONFLICT(item_id, location_id) DO UPDATE SET quantity = quantity + ?
          `,[I,a,A.quantity,A.quantity],{moduleId:"com.hubbi.inventory"})}else i==="sync"&&await y.db.execute(`
            INSERT INTO com_hubbi_inventory_stock (item_id, location_id, quantity)
            VALUES (?, ?, ?)
            ON CONFLICT(item_id, location_id) DO UPDATE SET quantity = ?
          `,[I,a,A.quantity,A.quantity],{moduleId:"com.hubbi.inventory"});H++}catch{A.error="Error al procesar",O++}x({success:H,errors:O}),m("result"),l(!1),H>0&&(n==null||n(H))},L=()=>{const M=`SKU,Nombre,Cantidad,Costo
PROD-001,Producto Ejemplo,100,25.50
`,P=new Blob([M],{type:"text/csv"}),H=URL.createObjectURL(P),O=document.createElement("a");O.href=H,O.download="plantilla_inventario.csv",O.click()};return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(bt,{className:"text-green-600",size:20}),"Importar desde Excel"]}),r.jsx("button",{onClick:e,className:"p-1 hover:bg-gray-100 rounded",children:r.jsx(ce,{size:20,className:"text-gray-500"})})]}),r.jsxs("div",{className:"p-6 flex-1 overflow-auto",children:[p==="upload"&&r.jsxs("div",{className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Modo de importaciÃ³n"}),r.jsx("div",{className:"space-y-2",children:uo.map(M=>r.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer ${i===M.value?"border-green-500 bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:[r.jsx("input",{type:"radio",name:"mode",value:M.value,checked:i===M.value,onChange:()=>s(M.value),className:"mt-1"}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:M.label}),r.jsx("div",{className:"text-sm text-gray-500",children:M.description})]})]},M.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bodega destino"}),r.jsx("select",{value:a,onChange:M=>d(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:u.map(M=>r.jsx("option",{value:M.id,children:M.name},M.id))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Archivo"}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-green-500 transition-colors",children:[r.jsx(_t,{size:40,className:"mx-auto text-gray-400 mb-3"}),r.jsx("p",{className:"text-gray-600 mb-2",children:"Arrastra tu archivo Excel o CSV aquÃ­"}),r.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:T,className:"hidden",id:"excel-input"}),r.jsx("label",{htmlFor:"excel-input",className:"inline-block px-4 py-2 bg-green-600 text-white rounded-lg cursor-pointer hover:bg-green-700",children:"Seleccionar archivo"})]})]}),r.jsxs("button",{onClick:L,className:"flex items-center gap-2 text-green-600 hover:text-green-700 text-sm",children:[r.jsx(yt,{size:16}),"Descargar plantilla de ejemplo"]})]}),p==="preview"&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-gray-600",children:[h.length," productos encontrados en ",t==null?void 0:t.name]}),r.jsx("button",{onClick:()=>m("upload"),className:"text-sm text-blue-600 hover:underline",children:"Cambiar archivo"})]}),r.jsx("div",{className:"border rounded-lg overflow-hidden max-h-64 overflow-auto",children:r.jsxs("table",{className:"w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 sticky top-0",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 py-2 text-left",children:"SKU"}),r.jsx("th",{className:"px-3 py-2 text-left",children:"Nombre"}),r.jsx("th",{className:"px-3 py-2 text-right",children:"Cantidad"}),r.jsx("th",{className:"px-3 py-2 text-right",children:"Costo"})]})}),r.jsx("tbody",{children:h.slice(0,50).map((M,P)=>r.jsxs("tr",{className:M.error?"bg-red-50":"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 py-2 font-mono",children:M.sku}),r.jsx("td",{className:"px-3 py-2",children:M.name||"-"}),r.jsx("td",{className:"px-3 py-2 text-right",children:M.quantity}),r.jsx("td",{className:"px-3 py-2 text-right",children:M.cost??"-"})]},P))})]})}),h.length>50&&r.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["Mostrando 50 de ",h.length," productos"]})]}),p==="result"&&r.jsxs("div",{className:"text-center py-8",children:[b.errors===0?r.jsx(te,{size:48,className:"mx-auto text-green-600 mb-4"}):r.jsx(Fn,{size:48,className:"mx-auto text-amber-500 mb-4"}),r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"ImportaciÃ³n completada"}),r.jsxs("p",{className:"text-gray-600",children:[b.success," productos importados exitosamente",b.errors>0&&`, ${b.errors} errores`]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 px-6 py-4 border-t bg-gray-50",children:[r.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg",children:p==="result"?"Cerrar":"Cancelar"}),p==="preview"&&r.jsxs("button",{onClick:V,disabled:c||h.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:[r.jsx(_t,{size:16}),c?"Importando...":`Importar ${h.length} productos`]})]})]})})},po=[{value:"stock",label:"Reporte de Stock",description:"Stock actual por bodega y producto"},{value:"kardex",label:"Kardex",description:"Historial de movimientos por producto"},{value:"valuation",label:"ValorizaciÃ³n",description:"Stock con costos y valor total"},{value:"low_stock",label:"Stock Bajo",description:"Productos por debajo del punto de reorden"}],fo=({onClose:e})=>{const[n,t]=v.useState("stock"),[o,i]=v.useState("all"),[s,a]=v.useState([]),[d,u]=v.useState(""),[g,h]=v.useState(""),[f,c]=v.useState(!1),[l,p]=v.useState(!1),{getEffectiveSubHubId:m}=re();v.useState(()=>{(async()=>{const w=await y.db.query("SELECT id, name FROM com_hubbi_inventory_locations WHERE is_active = TRUE",[],{moduleId:"com.hubbi.inventory"});a(w)})()});const b=async()=>{var H;c(!0);let x=[],w="",S=[];const F=m(),C=F?`AND l.sub_hub_id = '${F}'`:"",T=o!=="all"?`AND s.location_id = '${o}'`:"";if(n==="stock")w="stock_report",S=["SKU","Producto","Bodega","Stock","Unidad","MÃ­nimo","Reorden"],x=await y.db.query(`
        SELECT 
          i.sku, i.name as producto, l.name as bodega, 
          s.quantity as stock, i.primary_unit as unidad,
          s.min_stock as minimo, s.reorder_point as reorden
        FROM com_hubbi_inventory_stock s
        JOIN com_hubbi_inventory_items i ON s.item_id = i.id
        JOIN com_hubbi_inventory_locations l ON s.location_id = l.id
        WHERE i.is_active = TRUE ${T} ${C}
        ORDER BY i.name
      `,[],{moduleId:"com.hubbi.inventory"});else if(n==="kardex"){w="kardex",S=["Fecha","SKU","Producto","Bodega","Tipo","RazÃ³n","Cantidad","Costo","Total"];const O=d&&g?`AND m.created_at BETWEEN '${d}' AND '${g}'`:"";x=await y.db.query(`
        SELECT 
          m.created_at as fecha, i.sku, i.name as producto, l.name as bodega,
          m.type as tipo, m.reason as razon, m.quantity as cantidad,
          m.cost_at_moment as costo, m.total_value as total
        FROM com_hubbi_inventory_movements m
        JOIN com_hubbi_inventory_items i ON m.item_id = i.id
        JOIN com_hubbi_inventory_locations l ON m.location_id = l.id
        WHERE 1=1 ${T} ${C} ${O}
        ORDER BY m.created_at DESC
        LIMIT 5000
      `,[],{moduleId:"com.hubbi.inventory"})}else n==="valuation"?(w="valorizacion",S=["SKU","Producto","Bodega","Stock","Costo Unitario","Valor Total"],x=await y.db.query(`
        SELECT 
          i.sku, i.name as producto, l.name as bodega, s.quantity as stock,
          i.weighted_average_cost as costo_unitario,
          (s.quantity * i.weighted_average_cost) as valor_total
        FROM com_hubbi_inventory_stock s
        JOIN com_hubbi_inventory_items i ON s.item_id = i.id
        JOIN com_hubbi_inventory_locations l ON s.location_id = l.id
        WHERE i.is_active = TRUE ${T} ${C}
        ORDER BY valor_total DESC
      `,[],{moduleId:"com.hubbi.inventory"})):n==="low_stock"&&(w="stock_bajo",S=["SKU","Producto","Bodega","Stock Actual","Punto Reorden","DÃ©ficit"],x=await y.db.query(`
        SELECT 
          i.sku, i.name as producto, l.name as bodega, s.quantity as stock_actual,
          s.reorder_point as punto_reorden,
          (s.reorder_point - s.quantity) as deficit
        FROM com_hubbi_inventory_stock s
        JOIN com_hubbi_inventory_items i ON s.item_id = i.id
        JOIN com_hubbi_inventory_locations l ON s.location_id = l.id
        WHERE i.is_active = TRUE 
          AND s.quantity <= s.reorder_point 
          ${T} ${C}
        ORDER BY deficit DESC
      `,[],{moduleId:"com.hubbi.inventory"}));const V=[S.join(","),...x.map(O=>S.map((j,B)=>{const G=Object.keys(O)[B],A=O[G];return typeof A=="string"&&A.includes(",")?`"${A}"`:A}).join(","))].join(`
`),L=new Blob(["\uFEFF"+V],{type:"text/csv;charset=utf-8"}),M=URL.createObjectURL(L),P=document.createElement("a");P.href=M,P.download=`${w}_${new Date().toISOString().split("T")[0]}.csv`,P.click(),URL.revokeObjectURL(M),await y.db.execute(`
      INSERT INTO com_hubbi_inventory_export_logs (id, export_type, record_count, exported_by, exported_at)
      VALUES (?, ?, ?, ?, ?)
    `,[crypto.randomUUID(),n,x.length,((H=y.getContext())==null?void 0:H.userId)||"system",new Date().toISOString()],{moduleId:"com.hubbi.inventory"}),c(!1),p(!0),y.notify(`Exportados ${x.length} registros`,"success")};return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(bt,{className:"text-blue-600",size:20}),"Exportar a Excel"]}),r.jsx("button",{onClick:e,className:"p-1 hover:bg-gray-100 rounded",children:r.jsx(ce,{size:20,className:"text-gray-500"})})]}),r.jsx("div",{className:"p-6 space-y-5",children:l?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(te,{size:48,className:"mx-auto text-green-600 mb-4"}),r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"ExportaciÃ³n completada"}),r.jsx("p",{className:"text-gray-600",children:"El archivo se ha descargado a tu computadora"})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de reporte"}),r.jsx("div",{className:"space-y-2",children:po.map(x=>r.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer ${n===x.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[r.jsx("input",{type:"radio",name:"exportType",value:x.value,checked:n===x.value,onChange:()=>t(x.value),className:"mt-1"}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:x.label}),r.jsx("div",{className:"text-sm text-gray-500",children:x.description})]})]},x.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bodega"}),r.jsxs("select",{value:o,onChange:x=>i(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[r.jsx("option",{value:"all",children:"Todas las bodegas"}),s.map(x=>r.jsx("option",{value:x.id,children:x.name},x.id))]})]}),n==="kardex"&&r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),r.jsx("input",{type:"date",value:d,onChange:x=>u(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),r.jsx("input",{type:"date",value:g,onChange:x=>h(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})}),r.jsxs("div",{className:"flex justify-end gap-3 px-6 py-4 border-t bg-gray-50 rounded-b-xl",children:[r.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg",children:l?"Cerrar":"Cancelar"}),!l&&r.jsxs("button",{onClick:b,disabled:f,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[r.jsx(yt,{size:16}),f?"Exportando...":"Exportar"]})]})]})})};async function Xe(e){const{itemId:n,locationId:t}=e;let o=`
    SELECT 
      s.item_id as itemId,
      s.location_id as locationId,
      s.quantity as totalStock,
      COALESCE((
        SELECT SUM(r.quantity) 
        FROM com_hubbi_inventory_reservations r 
        WHERE r.item_id = s.item_id 
          AND r.location_id = s.location_id 
          AND r.status = 'active'
      ), 0) as reservedStock,
      s.min_stock as minStock,
      s.reorder_point as reorderPoint
    FROM com_hubbi_inventory_stock s
    WHERE s.item_id = ?
  `;const i=[n];return t&&(o+=" AND s.location_id = ?",i.push(t)),(await y.db.query(o,i,{moduleId:"com.hubbi.inventory"})).map(a=>({itemId:a.itemId,locationId:a.locationId,totalStock:a.totalStock,reservedStock:a.reservedStock,availableStock:a.totalStock-a.reservedStock,minStock:a.minStock,reorderPoint:a.reorderPoint}))}async function Se(e){const n=await Xe({itemId:e.itemId,locationId:e.locationId});if(n.length===0)return{available:!1,currentStock:0,requestedQuantity:e.quantity};const t=n[0];return{available:t.availableStock>=e.quantity,currentStock:t.availableStock,requestedQuantity:e.quantity}}async function It(e){let n=`
    SELECT 
      i.id as itemId,
      i.name as itemName,
      i.sku,
      s.location_id as locationId,
      s.quantity as currentStock,
      s.reorder_point as reorderPoint,
      (s.reorder_point - s.quantity) as deficit
    FROM com_hubbi_inventory_stock s
    JOIN com_hubbi_inventory_items i ON s.item_id = i.id
    WHERE s.quantity <= s.reorder_point
      AND i.is_active = TRUE
  `;const t=[];return e!=null&&e.locationId&&(n+=" AND s.location_id = ?",t.push(e.locationId)),n+=" ORDER BY deficit DESC",await y.db.query(n,t,{moduleId:"com.hubbi.inventory"})}async function kt(e){var o;const n=await Se({itemId:e.itemId,locationId:e.locationId,quantity:e.quantity});if(!n.available)return{success:!1,error:`Stock insuficiente. Disponible: ${n.currentStock}, Solicitado: ${e.quantity}`};const t=crypto.randomUUID();return await y.db.execute(`
    INSERT INTO com_hubbi_inventory_reservations 
      (id, item_id, location_id, quantity, reference_type, reference_id, created_by, expires_at, status)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'active')
  `,[t,e.itemId,e.locationId,e.quantity,e.referenceType,e.referenceId,e.createdBy,e.expiresAt||null],{moduleId:"com.hubbi.inventory"}),ie("reservation:created",{reservationId:t,itemId:e.itemId,quantity:e.quantity,referenceType:e.referenceType,referenceId:e.referenceId}),(o=y.audit)==null||o.call(y,{action:"reservation_created",entity:"inventory_reservation",entityId:t,description:`Reserva de ${e.quantity} unidades para ${e.referenceType}:${e.referenceId}`}),{success:!0,reservationId:t}}async function Ft(e){const n=await y.db.query("SELECT * FROM com_hubbi_inventory_reservations WHERE id = ? AND status = 'active'",[e.reservationId],{moduleId:"com.hubbi.inventory"});if(n.length===0)return{success:!1,error:"Reserva no encontrada o ya consumida"};const t=n[0],o=crypto.randomUUID(),i=await y.db.query("SELECT weighted_average_cost FROM com_hubbi_inventory_items WHERE id = ?",[t.item_id],{moduleId:"com.hubbi.inventory"}),s=i.length>0?i[0].weighted_average_cost:0,a=t.quantity;return await y.db.execute(`
    INSERT INTO com_hubbi_inventory_movements 
      (id, item_id, location_id, type, reason, quantity, cost_at_moment, total_value, created_by)
    VALUES (?, ?, ?, 'OUT', 'internal_use', ?, ?, ?, ?)
  `,[o,t.item_id,t.location_id,a,s,a*s,e.consumedBy],{moduleId:"com.hubbi.inventory"}),await y.db.execute(`
    UPDATE com_hubbi_inventory_stock 
    SET quantity = quantity - ? 
    WHERE item_id = ? AND location_id = ?
  `,[a,t.item_id,t.location_id],{moduleId:"com.hubbi.inventory"}),await y.db.execute(`
    UPDATE com_hubbi_inventory_reservations SET status = 'consumed' WHERE id = ?
  `,[e.reservationId],{moduleId:"com.hubbi.inventory"}),ie("reservation:consumed",{reservationId:e.reservationId,movementId:o,itemId:t.item_id,quantity:a}),ie("stock:decreased",{itemId:t.item_id,locationId:t.location_id,quantity:a,reason:"internal_use",movementId:o}),{success:!0,movementId:o}}async function Mt(e){return await y.db.execute(`
    UPDATE com_hubbi_inventory_reservations SET status = 'cancelled' WHERE id = ?
  `,[e.reservationId],{moduleId:"com.hubbi.inventory"}),ie("reservation:cancelled",{reservationId:e.reservationId,reason:e.reason}),{success:!0}}async function Ze(e){var u;if(e.type==="OUT"&&e.reason!=="correction"){const g=await Se({itemId:e.itemId,locationId:e.locationId,quantity:e.quantity});if(!g.available)return{success:!1,error:`Stock insuficiente. Disponible: ${g.currentStock}, Solicitado: ${e.quantity}`}}let n=e.periodId;if(!n){const g=await _e();n=g==null?void 0:g.id}if(n&&!await Ye(n))return{success:!1,error:`El perÃ­odo ${n} estÃ¡ cerrado o bloqueado. No se pueden registrar movimientos.`};if(e.subHubId){const g=y.permissions.has("inventory:edit_all_subhubs"),h=y.getContext(),f=e.subHubId===(h==null?void 0:h.subHubId),c=y.permissions.has("inventory:edit_own_subhub")&&f;if(!g&&!c)return{success:!1,error:"No tienes permiso para modificar inventario de esta sucursal."}}const t=crypto.randomUUID();let o=e.unitCost||0;if(!e.unitCost){const g=await y.db.query("SELECT weighted_average_cost FROM com_hubbi_inventory_items WHERE id = ? ",[e.itemId],{moduleId:"com.hubbi.inventory"});o=g.length>0?g[0].weighted_average_cost:0}await y.db.execute(`
    INSERT INTO com_hubbi_inventory_movements
                (id, item_id, location_id, type, reason, quantity, cost_at_moment, total_value,
                    document_type, document_number, document_uuid, created_by, sub_hub_id, period_id)
            VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                `,[t,e.itemId,e.locationId,e.type,e.reason,e.quantity,o,e.quantity*o,e.documentType||null,e.documentNumber||null,e.documentUuid||null,e.createdBy,e.subHubId||null,n||null],{moduleId:"com.hubbi.inventory"});let i=e.quantity;e.type==="OUT"||e.type==="TRANSFER_OUT"?i=-e.quantity:e.type==="ADJUST"&&(i=e.quantity),await y.db.execute(`
    INSERT INTO com_hubbi_inventory_stock(item_id, location_id, quantity)
            VALUES(?, ?, ?)
    ON CONFLICT(item_id, location_id) DO UPDATE SET quantity = quantity + ?
                `,[e.itemId,e.locationId,i,i],{moduleId:"com.hubbi.inventory"}),(e.type==="IN"||e.type==="TRANSFER_IN")&&e.unitCost&&await ho(e.itemId,e.quantity,e.unitCost);const s=await y.db.query("SELECT quantity FROM com_hubbi_inventory_stock WHERE item_id = ? AND location_id = ? ",[e.itemId,e.locationId],{moduleId:"com.hubbi.inventory"}),a=s.length>0?s[0].quantity:0,d=e.type==="IN"||e.type==="TRANSFER_IN"||e.type==="ADJUST"&&e.quantity>0;return ie(d?"stock:increased":"stock:decreased",{itemId:e.itemId,locationId:e.locationId,quantity:e.quantity,reason:e.reason,movementId:t,newStock:a}),(u=y.audit)==null||u.call(y,{action:`stock_${e.type.toLowerCase()}`,entity:"inventory_movement",entityId:t,description:`${e.type==="IN"?"Entrada":"Salida"} de ${e.quantity} unidades - ${e.reason}`}),{success:!0,movementId:t,newStock:a}}async function ho(e,n,t){const o=await y.db.query("SELECT weighted_average_cost FROM com_hubbi_inventory_items WHERE id = ? ",[e],{moduleId:"com.hubbi.inventory"}),i=await y.db.query("SELECT SUM(quantity) as total FROM com_hubbi_inventory_stock WHERE item_id = ? ",[e],{moduleId:"com.hubbi.inventory"}),s=o.length>0?o[0].weighted_average_cost:0,a=i.length>0?i[0].total-n:0,d=a*s,u=n*t,g=a+n,h=g>0?(d+u)/g:t;await y.db.execute("UPDATE com_hubbi_inventory_items SET weighted_average_cost = ?, last_cost = ? WHERE id = ? ",[h,t,e],{moduleId:"com.hubbi.inventory"})}async function Tt(e){let n="SELECT * FROM com_hubbi_inventory_items WHERE ";const t=[];if(e.id)n+="id = ? ",t.push(e.id);else if(e.sku)n+="sku = ? ",t.push(e.sku);else return null;const o=await y.db.query(n,t,{moduleId:"com.hubbi.inventory"});return o.length>0?o[0]:null}async function At(e){let n=`
    SELECT * FROM com_hubbi_inventory_items 
    WHERE is_active = TRUE AND is_internal_use_only = FALSE
                `;const t=[];return e!=null&&e.categoryId&&(n+=" AND category_id = ? ",t.push(e.categoryId)),e!=null&&e.search&&(n+=" AND(name LIKE ? OR sku LIKE ?)",t.push(`% ${e.search}% `,` % ${e.search}% `)),n+=" ORDER BY name LIMIT ? ",t.push((e==null?void 0:e.limit)||100),await y.db.query(n,t,{moduleId:"com.hubbi.inventory"})}async function Dt(e){return await y.db.query(`
    SELECT
            k.child_item_id as componentId,
                i.name as componentName,
                i.sku as componentSku,
                k.quantity
    FROM com_hubbi_inventory_kits k
    JOIN com_hubbi_inventory_items i ON k.child_item_id = i.id
    WHERE k.parent_item_id = ?
                `,[e],{moduleId:"com.hubbi.inventory"})}function ie(e,n){window.dispatchEvent(new CustomEvent(`inventory:${e} `,{detail:{moduleId:"com.hubbi.inventory",timestamp:new Date().toISOString(),...n}}))}function Pt(){var e,n;(n=(e=window.hubbi)==null?void 0:e.modules)!=null&&n.expose&&(window.hubbi.modules.expose("getStock",Xe),window.hubbi.modules.expose("checkAvailability",Se),window.hubbi.modules.expose("getLowStockItems",It),window.hubbi.modules.expose("createReservation",kt),window.hubbi.modules.expose("consumeReservation",Ft),window.hubbi.modules.expose("cancelReservation",Mt),window.hubbi.modules.expose("recordMovement",Ze),window.hubbi.modules.expose("getItem",Tt),window.hubbi.modules.expose("getSellableItems",At),window.hubbi.modules.expose("getKitComponents",Dt),window.hubbi.modules.expose("getCurrentPeriod",_e),window.hubbi.modules.expose("isPeriodEditable",Ye))}const mo=()=>{const[e,n]=v.useState(!1);return{registerMovement:async o=>{var i,s;n(!0);try{const a=y.getContext(),d=await Ze({itemId:o.item.id,locationId:o.location_id,type:o.type,quantity:o.quantity,reason:o.reason||"other",unitCost:o.unit_cost,documentType:(i=o.reference)==null?void 0:i.type,documentNumber:(s=o.reference)==null?void 0:s.id,createdBy:(a==null?void 0:a.userId)||"system",subHubId:a==null?void 0:a.subHubId});if(!d.success)throw new Error(d.error||"Error desconocido al registrar movimiento");return y.notify.success("Movimiento registrado exitosamente"),{success:!0,movementId:d.movementId}}catch(a){return console.error(a),y.notify.error((a instanceof Error?a.message:String(a))||"Error al registrar movimiento"),{success:!1,error:a}}finally{n(!1)}},processing:e}},yo=async e=>{const n=crypto.randomUUID();await y.data.execute(`
        INSERT INTO com_hubbi_inventory_dte_events (id, event_type, movement_id, payload, status, created_at)
        VALUES (?, ?, ?, ?, 'pending', ?)
    `,[n,e.eventType,e.movement.id,JSON.stringify(e),new Date().toISOString()]),console.log(`[DTE Integration] Event emitted: ${e.eventType} for movement ${e.movement.id}`)},bo=async(e,n)=>{await y.data.execute(`
        UPDATE com_hubbi_inventory_movements 
        SET document_type = ?, document_number = ?, document_uuid = ?
        WHERE id = ?
    `,[n.documentType,n.documentNumber,n.documentUUID,e]),y.notify.success(`Movimiento vinculado a ${n.documentType} #${n.documentNumber}`)},vo=async()=>(await y.data.query(`
        SELECT payload FROM com_hubbi_inventory_dte_events 
        WHERE status = 'pending' 
        ORDER BY created_at ASC
        LIMIT 50
    `)||[]).map(n=>JSON.parse(n.payload)),xo=async e=>{await y.data.execute(`
        UPDATE com_hubbi_inventory_dte_events 
        SET status = 'processed' 
        WHERE movement_id = ?
    `,[e])};class _o{static calculateNewWeightedAverageCost(n,t,o,i){if(n+o===0)return 0;const s=Math.max(0,n),a=s*t+o*i,d=s+o;return d>0?parseFloat((a/d).toFixed(4)):0}static validateStockAvailability(n,t,o=!1){return t<=0?{allowed:!1,message:"La cantidad debe ser mayor a 0"}:!o&&n<t?{allowed:!1,message:`Stock insuficiente. Disponible: ${n}, Solicitado: ${t}`}:{allowed:!0}}static determineOutCost(n,t){return t!==void 0&&(n.type==="serialized"||n.type==="asset")?t:n.weighted_average_cost}}const So=[{id:"simple",label:"Producto Simple",icon:"Box",description:"Repuestos, consumibles, productos estÃ¡ndar"},{id:"serialized",label:"Serializado",icon:"Barcode",description:"Equipos con nÃºmero de serie Ãºnico"},{id:"kit",label:"Kit / Combo",icon:"Package",description:"Conjunto de productos que se venden juntos"},{id:"asset",label:"Activo Fijo",icon:"Truck",description:"VehÃ­culos, maquinaria, equipos de alto valor"},{id:"service",label:"Servicio",icon:"Wrench",description:"Mano de obra, servicios sin stock fÃ­sico"}],wo=[{id:"available",label:"Disponible",color:"green"},{id:"reserved",label:"Reservado",color:"yellow"},{id:"damaged",label:"DaÃ±ado",color:"red"},{id:"expired",label:"Vencido",color:"orange"},{id:"discontinued",label:"Descontinuado",color:"gray"}],Qe={simple:[{key:"location_rack",label:"UbicaciÃ³n (Estante)",type:"text",placeholder:"Ej: Pasillo A-2"},{key:"min_stock_alert",label:"Alerta Stock MÃ­nimo",type:"number",placeholder:"0"},{key:"weight",label:"Peso (kg)",type:"number",placeholder:"0.00"},{key:"dimensions",label:"Dimensiones (LxAxH cm)",type:"text",placeholder:"Ej: 10x5x3"}],serialized:[{key:"serial_number",label:"NÃºmero de Serie",type:"text",required:!0},{key:"warranty_months",label:"Meses de GarantÃ­a",type:"number",placeholder:"12"},{key:"warranty_expiry",label:"Vencimiento GarantÃ­a",type:"date"},{key:"manufacturer",label:"Fabricante",type:"text"},{key:"model_number",label:"NÃºmero de Modelo",type:"text"}],asset:[{key:"vin",label:"VIN / NÃºmero de Chasis",type:"text",required:!0,placeholder:"17 caracteres"},{key:"engine_number",label:"NÃºmero de Motor",type:"text",required:!0},{key:"license_plate",label:"Placa",type:"text"},{key:"year",label:"AÃ±o",type:"number",placeholder:"2024"},{key:"color",label:"Color",type:"text"},{key:"fuel_type",label:"Combustible",type:"select",options:["Diesel","Gasolina","ElÃ©ctrico","HÃ­brido","GLP"]},{key:"mileage",label:"Kilometraje",type:"number",placeholder:"0"},{key:"import_policy",label:"PÃ³liza de ImportaciÃ³n",type:"text"},{key:"acquisition_date",label:"Fecha de AdquisiciÃ³n",type:"date"},{key:"last_maintenance",label:"Ãšltimo Mantenimiento",type:"date"},{key:"notes",label:"Notas Adicionales",type:"textarea"}],kit:[{key:"is_preassembled",label:"Â¿Pre-ensamblado?",type:"boolean"},{key:"compatibility",label:"Compatibilidad",type:"text",placeholder:"Ej: Motores Cummins ISX"},{key:"assembly_time",label:"Tiempo de Ensamblaje (min)",type:"number"},{key:"instructions",label:"Instrucciones",type:"textarea"}],medicine:[{key:"batch_number",label:"NÃºmero de Lote",type:"text",required:!0},{key:"expiry_date",label:"Fecha de Vencimiento",type:"date",required:!0},{key:"active_ingredient",label:"Componente Activo",type:"text"},{key:"dosage",label:"Dosis",type:"text",placeholder:"Ej: 500mg"},{key:"storage_temp",label:"Temperatura de Almacenamiento",type:"select",options:["Ambiente","Refrigerado (2-8Â°C)","Congelado (-20Â°C)"]},{key:"requires_prescription",label:"Requiere Receta",type:"boolean"}],service:[{key:"duration_hours",label:"DuraciÃ³n Estimada (horas)",type:"number"},{key:"requires_appointment",label:"Requiere Cita",type:"boolean"},{key:"technician_level",label:"Nivel de TÃ©cnico",type:"select",options:["BÃ¡sico","Intermedio","Avanzado","Especialista"]}]},Co=[{id:"unit",label:"Unidad",abbreviation:"ud"},{id:"box",label:"Caja",abbreviation:"caja"},{id:"pack",label:"Paquete",abbreviation:"paq"},{id:"kg",label:"Kilogramo",abbreviation:"kg"},{id:"g",label:"Gramo",abbreviation:"g"},{id:"lb",label:"Libra",abbreviation:"lb"},{id:"l",label:"Litro",abbreviation:"L"},{id:"ml",label:"Mililitro",abbreviation:"mL"},{id:"gal",label:"GalÃ³n",abbreviation:"gal"},{id:"m",label:"Metro",abbreviation:"m"},{id:"cm",label:"CentÃ­metro",abbreviation:"cm"},{id:"ft",label:"Pie",abbreviation:"ft"},{id:"pair",label:"Par",abbreviation:"par"},{id:"dozen",label:"Docena",abbreviation:"doc"},{id:"set",label:"Juego",abbreviation:"jgo"}],No=[{id:"daily",label:"Diario",days:1},{id:"weekly",label:"Semanal",days:7},{id:"biweekly",label:"Quincenal",days:14},{id:"monthly",label:"Mensual",days:30},{id:"quarterly",label:"Trimestral",days:90},{id:"biannual",label:"Semestral",days:180},{id:"annual",label:"Anual",days:365}],Eo=[{id:"parts",label:"Repuestos",icon:"Cog"},{id:"consumables",label:"Consumibles",icon:"Droplet"},{id:"tools",label:"Herramientas",icon:"Wrench"},{id:"vehicles",label:"VehÃ­culos",icon:"Truck"},{id:"electronics",label:"ElectrÃ³nicos",icon:"Cpu"},{id:"office",label:"Oficina",icon:"FileText"},{id:"maintenance",label:"Mantenimiento",icon:"Tool"},{id:"safety",label:"Seguridad",icon:"Shield"}];function $t(e){return Qe[e]||Qe.simple}function Io(e,n){const t=$t(e),o=[];for(const i of t)i.required&&!n[i.key]&&o.push(`${i.label} es requerido`);return{valid:o.length===0,errors:o}}async function ko(e,n){try{let t=`
      SELECT 
        m.created_at as fecha,
        i.sku,
        i.name as producto,
        m.type as tipo,
        m.reason as motivo,
        m.quantity as cantidad,
        m.cost_at_moment as costo_unitario,
        m.total_value as valor_total,
        m.document_type as tipo_documento,
        m.document_number as numero_documento,
        l.name as ubicacion
      FROM com_hubbi_inventory_movements m
      JOIN com_hubbi_inventory_items i ON m.item_id = i.id
      LEFT JOIN com_hubbi_inventory_locations l ON m.location_id = l.id
      WHERE 1=1
    `;const o=[];e&&(t+=" AND m.item_id = ?",o.push(e)),n!=null&&n.startDate&&(t+=" AND m.created_at >= ?",o.push(n.startDate)),n!=null&&n.endDate&&(t+=" AND m.created_at <= ?",o.push(n.endDate)),n!=null&&n.locationId&&(t+=" AND m.location_id = ?",o.push(n.locationId)),t+=" ORDER BY m.created_at DESC";const i=await y.db.query(t,o,{moduleId:"com.hubbi.inventory"});return{success:!0,data:Ot(i),rowCount:i.length}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Error al exportar Kardex"}}}async function Fo(e){try{let n=`
      SELECT 
        i.sku,
        i.name as producto,
        i.category_id as categoria,
        i.type as tipo,
        i.weighted_average_cost as costo_promedio,
        s.quantity as cantidad,
        (s.quantity * i.weighted_average_cost) as valor_total,
        l.name as ubicacion
      FROM com_hubbi_inventory_items i
      JOIN com_hubbi_inventory_stock s ON i.id = s.item_id
      LEFT JOIN com_hubbi_inventory_locations l ON s.location_id = l.id
      WHERE i.is_active = TRUE
    `;const t=[];e!=null&&e.locationId&&(n+=" AND s.location_id = ?",t.push(e.locationId)),e!=null&&e.categoryId&&(n+=" AND i.category_id = ?",t.push(e.categoryId)),e!=null&&e.itemType&&(n+=" AND i.type = ?",t.push(e.itemType)),n+=" ORDER BY i.name";const o=await y.db.query(n,t,{moduleId:"com.hubbi.inventory"}),i=o.reduce((s,a)=>s+(a.valor_total||0),0);return{success:!0,data:Ot(o,{footer:`TOTAL VALORIZACIÃ“N: ${i.toFixed(2)}`}),rowCount:o.length}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Error al exportar valorizaciÃ³n"}}}async function Mo(e,n){try{const{startDate:t,endDate:o}=Ao(e,n),s=await y.db.query(`
      SELECT 
        m.type,
        m.reason,
        COUNT(*) as cantidad_movimientos,
        SUM(m.quantity) as unidades_totales,
        SUM(m.total_value) as valor_total
      FROM com_hubbi_inventory_movements m
      WHERE m.created_at >= ? AND m.created_at <= ?
      GROUP BY m.type, m.reason
      ORDER BY m.type, m.reason
    `,[t,o],{moduleId:"com.hubbi.inventory"}),d=await y.db.query(`
      SELECT 
        i.type,
        COUNT(DISTINCT i.id) as productos,
        SUM(s.quantity) as unidades,
        SUM(s.quantity * i.weighted_average_cost) as valor
      FROM com_hubbi_inventory_items i
      JOIN com_hubbi_inventory_stock s ON i.id = s.item_id
      WHERE i.is_active = TRUE
      GROUP BY i.type
    `,[],{moduleId:"com.hubbi.inventory"}),u={periodo:`${n} ${e}`,fecha_inicio:t,fecha_fin:o,resumen_movimientos:s,stock_al_cierre:d};return{success:!0,data:JSON.stringify(u,null,2),rowCount:s.length+d.length}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Error al generar resumen fiscal"}}}async function To(e){const n=crypto.randomUUID();await y.db.execute(`
    INSERT INTO com_hubbi_inventory_export_logs 
      (id, report_type, format, period_start, period_end, filters, row_count, generated_by, file_path, file_size)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
  `,[n,e.reportType,e.format,e.periodStart||null,e.periodEnd||null,e.filters?JSON.stringify(e.filters):null,e.rowCount,e.userId,e.filePath||null,e.fileSize||null],{moduleId:"com.hubbi.inventory"})}function Ot(e,n){if(e.length===0)return"";const t=Object.keys(e[0]),o=[];o.push(t.join(","));for(const i of e){const s=t.map(a=>{const d=i[a];return d==null?"":typeof d=="string"&&(d.includes(",")||d.includes('"'))?`"${d.replace(/"/g,'""')}"`:String(d)});o.push(s.join(","))}return n!=null&&n.footer&&(o.push(""),o.push(n.footer)),o.join(`
`)}function Ao(e,n){switch(n){case"Q1":return{startDate:`${e}-01-01`,endDate:`${e}-03-31`};case"Q2":return{startDate:`${e}-04-01`,endDate:`${e}-06-30`};case"Q3":return{startDate:`${e}-07-01`,endDate:`${e}-09-30`};case"Q4":return{startDate:`${e}-10-01`,endDate:`${e}-12-31`};case"annual":default:return{startDate:`${e}-01-01`,endDate:`${e}-12-31`}}}const Lt=()=>r.jsxs("div",{className:"inventory-settings p-4",children:[r.jsx("h2",{className:"text-lg font-bold",children:"ConfiguraciÃ³n de Inventario"}),r.jsx("p",{className:"text-gray-500",children:"PrÃ³ximamente: Ajustes de costos, prefijos y permisos."})]}),Vt=()=>r.jsx(Ct,{compact:!0}),qt=()=>{var t,o,i;if(!(((i=(o=(t=window.hubbi)==null?void 0:t.permissions)==null?void 0:o.has)==null?void 0:i.call(o,"inventory:access"))??!0))return null;const n=()=>{var s,a;return(a=(s=window.hubbi)==null?void 0:s.navigate)==null?void 0:a.call(s,"/inventory")};return r.jsxs("button",{onClick:n,className:"w-full text-left px-3 py-2 hover:bg-gray-100 rounded-lg flex items-center gap-2",children:[r.jsx("svg",{className:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),r.jsx("span",{children:"Inventario"})]})},Do=async()=>{var e,n;(n=(e=window.hubbi)==null?void 0:e.widgets)!=null&&n.register&&(window.hubbi.widgets.register({slotName:"settings_tab",moduleId:"com.hubbi.inventory",component:Lt,priority:10}),window.hubbi.widgets.register({slotName:"dashboard_widget",moduleId:"com.hubbi.inventory",component:Vt,priority:20}),window.hubbi.widgets.register({slotName:"sidebar_item",moduleId:"com.hubbi.inventory",component:qt,priority:30})),Pt(),Po()};async function Po(){var e,n,t;if(!(!((n=(e=window.hubbi)==null?void 0:e.db)!=null&&n.query)||!((t=window.hubbi)!=null&&t.sendNotification)))try{const o=await window.hubbi.db.query(`
      SELECT i.name, s.quantity, s.reorder_point, l.name as location_name
      FROM com_hubbi_inventory_stock s
      JOIN com_hubbi_inventory_items i ON s.item_id = i.id
      JOIN com_hubbi_inventory_locations l ON s.location_id = l.id
      WHERE s.quantity <= s.min_stock AND i.is_active = TRUE
      LIMIT 5
    `,[],{moduleId:"com.hubbi.inventory"});o.length>0&&await window.hubbi.sendNotification({title:"âš ï¸ Stock CrÃ­tico",message:`${o.length} productos requieren reabastecimiento urgente`,category:"inventory",severity:"warning",actionUrl:"/inventory/alerts"})}catch{}}const $o={id:"com.hubbi.inventory",name:"Hubbi Inventory & WMS",version:"1.0.0",emittedEvents:["inventory:stock:increased","inventory:stock:decreased","inventory:reservation:created","inventory:reservation:consumed","inventory:reservation:cancelled","inventory:item:created","inventory:item:updated","inventory:transfer:requested","inventory:transfer:approved","inventory:transfer:received"],exposedMethods:["getStock","checkAvailability","getLowStockItems","createReservation","consumeReservation","cancelReservation","recordMovement","getItem","getSellableItems","getKitComponents","getCurrentPeriod","isPeriodEditable"]};_.CYCLIC_COUNT_FREQUENCIES=No,_.DEFAULT_CATEGORIES=Eo,_.ExcelExport=fo,_.ExcelImport=go,_.InventoryCore=_o,_.InventoryDashboardWidget=Vt,_.InventorySettingsTab=Lt,_.InventorySidebar=qt,_.KitsManager=Jn,_.MobileScanner=Qn,_.MovementsHistory=Rn,_.PRODUCT_SCHEMAS=Qe,_.PRODUCT_STATUS=wo,_.PRODUCT_TYPES=So,_.PeriodBadge=oo,_.PeriodSelector=no,_.PhysicalAudit=eo,_.ProductForm=Kn,_.ProductsTable=Wn,_.QuickAdjust=co,_.RemissionNote=Xn,_.StockAlertsPanel=Ct,_.SubHubBadge=ao,_.SubHubSelector=so,_.TransferDashboard=Yn,_.UNITS_OF_MEASURE=Co,_.VisualWarehouse=Zn,_.cancelReservation=Mt,_.checkAvailability=Se,_.consumeReservation=Ft,_.createReservation=kt,_.emitDTEEvent=yo,_.emitInventoryEvent=ie,_.exportFiscalSummary=Mo,_.exportKardex=ko,_.exportStockValuation=Fo,_.getCurrentPeriod=_e,_.getItem=Tt,_.getKitComponents=Dt,_.getLowStockItems=It,_.getPendingDTEEvents=vo,_.getPeriodById=Nt,_.getSchemaForType=$t,_.getSellableItems=At,_.getStock=Xe,_.getSubHubIdFromContext=ro,_.isPeriodEditableById=Ye,_.linkMovementToDTE=bo,_.logExport=To,_.markDTEEventProcessed=xo,_.moduleInfo=$o,_.onActivate=Do,_.recordMovement=Ze,_.registerInventoryAPI=Pt,_.useFiscalPeriods=ue,_.useInventoryActions=St,_.useInventoryMovements=mo,_.useStockAlerts=wt,_.useSubHubFilter=re,_.validateAttributes=Io,_.validateSubHubPermission=io,Object.defineProperty(_,Symbol.toStringTag,{value:"Module"})});
